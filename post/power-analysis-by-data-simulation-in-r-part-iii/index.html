<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.7.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Julian Quandt">

  
  
  
    
  
  <meta name="description" content="This part extends the previous part by generalizing data simulation to ANOVA and general linear model designs.">

  
  <link rel="alternate" hreflang="en-us" href="https://julianquandt.com/post/power-analysis-by-data-simulation-in-r-part-iii/">

  


  
  
  
  <meta name="theme-color" content="rgb(0, 136, 204)">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/foundation.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/foundation.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-164327345-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           document.location = url;
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target);  
  }

  gtag('js', new Date());
  gtag('config', 'UA-164327345-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="https://julianquandt.com/post/power-analysis-by-data-simulation-in-r-part-iii/">

  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Julian Quandt">
  <meta property="og:url" content="https://julianquandt.com/post/power-analysis-by-data-simulation-in-r-part-iii/">
  <meta property="og:title" content="Power Analysis by Data Simulation in R - Part III | Julian Quandt">
  <meta property="og:description" content="This part extends the previous part by generalizing data simulation to ANOVA and general linear model designs."><meta property="og:image" content="img/map[gravatar:%!s(bool=false) shape:circle]">
  <meta property="twitter:image" content="img/map[gravatar:%!s(bool=false) shape:circle]"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-06-16T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-07-01T12:55:40&#43;00:00">
  

  


    






  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://julianquandt.com/post/power-analysis-by-data-simulation-in-r-part-iii/"
  },
  "headline": "Power Analysis by Data Simulation in R - Part III",
  
  "datePublished": "2020-06-16T00:00:00Z",
  "dateModified": "2020-07-01T12:55:40Z",
  
  "author": {
    "@type": "Person",
    "name": "Julian Quandt"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Julian Quandt",
    "logo": {
      "@type": "ImageObject",
      "url": "img/https://julianquandt.com/"
    }
  },
  "description": "This part extends the previous part by generalizing data simulation to ANOVA and general linear model designs."
}
</script>

  

  


  


  





  <title>Power Analysis by Data Simulation in R - Part III | Julian Quandt</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="dark">

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Julian Quandt</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Julian Quandt</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#talks"><span>Talks</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#publications"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#resources"><span>Resources</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item">
        <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
      </li>
      

      

    </ul>

  </div>
</nav>


  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Power Analysis by Data Simulation in R - Part III</h1>

  
  <p class="page-subtitle">Part III - Exploring ANOVA designs and linear models</p>
  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
          Last updated on
      
    
    Jul 1, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    36 min read
  </span>
  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/power-analysis/">Power Analysis</a></span>
  

</div>

    













<div class="btn-links mb-3">
  
  








  









  
    
  











</div>


  
</div>



  <div class="article-container">

    <div class="article-style">
      
<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>

<div id="TOC">
<ul>
<li><a href="#the-power-analysis-by-simulation-in-r-for-really-any-design---part-iii">The Power Analysis by simulation in <code>R</code> for really any design - Part III</a></li>
<li><a href="#footnotes">Footnotes</a></li>
</ul>
</div>

<html>
<link rel="stylesheet" href="/css/style.css" />
</html>
<p><div class="alert alert-note">
  <div>
    <!-- raw HTML omitted -->Click below to download the .Rmd file<!-- raw HTML omitted -->
  </div>
</div>
</p>
<a href="data:text/x-markdown;base64,LS0tDQp0aXRsZTogUG93ZXIgQW5hbHlzaXMgYnkgRGF0YSBTaW11bGF0aW9uIGluIFIgLSBQYXJ0IElJDQphdXRob3I6IH4NCmRhdGU6ICcyMDIwLTA1LTEyJw0Kc2x1ZzogcG93ZXItYW5hbHlzaXMtYnktZGF0YS1zaW11bGF0aW9uLWluLXItcGFydC1paQ0KY2F0ZWdvcmllczogW1Bvd2VyIEFuYWx5c2lzXQ0KdGFnczogW3Bvd2VyLCBkYXRhLXNpbXVsYXRpb24sIFJdDQpzdWJ0aXRsZTogJ1BhcnQgSUkgLSBzaW11bGF0aW5nIGdyb3VwcyBhbmQgcG93ZXJpbmcgdC10ZXN0cycNCnN1bW1hcnk6ICdUaGlzIHBhcnQgZm91Y3VzZXMgb24gc2ltcGxlIHNjZW5hcmlvcyAodC10ZXN0cykgdG8gaW50cm9kdWNlIHRoZSBzaW11bGF0aW9uIG9mIGNvcnJlbGF0ZWQgbWVhc3VyZW1lbnRzIGFuZCBtdWx0aXZhcmlhdGUgbm9ybWFsLWRpc3RyaWJ1dGlvbnMnDQphdXRob3JzOiBbXQ0KbGFzdG1vZDogImByIGZvcm1hdChTeXMudGltZSgpKWAiDQpmZWF0dXJlZDogbm8NCmNvZGVfZG93bmxvYWQ6IHRydWUNCmltYWdlOg0KICBjYXB0aW9uOiAnJw0KICBmb2NhbF9wb2ludDogJycNCiAgcHJldmlld19vbmx5OiBubw0KcHJvamVjdHM6IFtQb3dlciBBbmFseXNpcyBUdXRvcmlhbF0NCm91dHB1dDoNCiAgYmxvZ2Rvd246Omh0bWxfcGFnZToNCiAgICB0b2M6IHRydWUNCiAgICB0b2NfZGVwdGg6IDMNCi0tLQ0KDQo8aHRtbD4NCiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Ii9jc3Mvc3R5bGUuY3NzIiAvPg0KPC9odG1sPg0KDQoNCmBgYHtyIHNldHVwLCBpbmNsdWRlPUZBTFNFfQ0KcmVxdWlyZShrbml0cikNCmtuaXRyOjpvcHRzX2NodW5rJHNldChlY2hvID0gVCwgd2FybmluZyA9IEYsIGNhY2hlID0gVCkNCm9wdGlvbnMod2lkdGggPSA4MCkNCm9wdGlvbnMoc2NpcGVuID0gMTApDQojc291cmNlKCJjb21tb25fcGFja2FnZXMuUiIpDQpkZXZBc2tOZXdQYWdlKGFzayA9IEZBTFNFKQ0KYGBgDQoNCnt7JSBhbGVydCBub3RlICV9fQ0KX19DbGljayBiZWxvdyB0byBkb3dubG9hZCB0aGUgLlJtZCBmaWxlX18NCnt7JSAvYWxlcnQgJX19DQoNCmBgYHtyIGVjaG89RkFMU0V9DQp4ZnVuOjplbWJlZF9maWxlKCcuLzIwMjAtMDUtMTItcG93ZXItYW5hbHlzaXMtYnktZGF0YS1zaW11bGF0aW9uLWluLXItcGFydC1paS5SbWQnLCAicG93ZXItYW5hbHlzaXMtYnktZGF0YS1zaW11bGF0aW9uLWluLXItcGFydC1paS5SbWQiKQ0KYGBgDQoNCg0KYGBge2NzcyxlY2hvPUZBTFNFfQ0KYnV0dG9uLmJ0bi5jb2xsYXBzZWQ6YmVmb3JlDQp7DQogICAgY29udGVudDonKycgOw0KICAgIGRpc3BsYXk6YmxvY2s7DQogICAgd2lkdGg6MTVweDsNCn0NCmJ1dHRvbi5idG46YmVmb3JlDQp7DQogICAgY29udGVudDonLScgOw0KICAgIGRpc3BsYXk6YmxvY2s7DQogICAgd2lkdGg6MTVweDsNCn0NCmBgYA0KDQpgYGB7cixlY2hvPUZBTFNFLHJlc3VsdHM9J2hpZGUnfQ0Ka25pdHI6OmtuaXRfaG9va3Mkc2V0KGRyb3AxPWZ1bmN0aW9uKGJlZm9yZSwgb3B0aW9ucywgZW52aXIpIHsNCiAgICBpZiAoYmVmb3JlKSB7DQogICAgICAgIHBhc3RlKA0KICAgICAgICAgICAgJzxwPicsDQonPGJ1dHRvbiBjbGFzcz0iYnRuIGJ0bi1wcmltYXJ5IGNvbGxhcHNlZCIgZGF0YS10b2dnbGU9ImNvbGxhcHNlIiBkYXRhLXRhcmdldD0iI2NlMSI+JywNCic8L2J1dHRvbj4nLA0KJzwvcD4nLA0KJzxkaXYgY2xhc3M9ImNvbGxhcHNlIiBpZD0iY2UxIj4nLA0KJzxkaXYgY2xhc3M9ImNhcmQgY2FyZC1ib2R5Ij4nLCAgc2VwID0gIlxuIikNCiAgICB9IGVsc2Ugew0KICAgICAgICBwYXN0ZSgiPC9kaXY+IiwgIjwvZGl2PiIsIHNlcCA9ICJcbiIpDQogICAgfQ0KfSkNCmBgYA0KDQpfVGhpcyBibG9nIGlzIGFsc28gYXZhaWxhYmxlIG9uIFtSLUJsb2dnZXJzXShodHRwczovL3d3dy5yLWJsb2dnZXJzLmNvbS8pXw0KDQojIFRoZSBQb3dlciBBbmFseXNpcyBieSBzaW11bGF0aW9uIGluIGBSYCBmb3IgcmVhbGx5IGFueSBkZXNpZ24gLSBQYXJ0IElJDQoNClRoaXMgaXMgUGFydCBJSSBvZiBteSB0dXRvcmlhbCBvbiBob3cgdG8gZG8gcG93ZXItYW5hbHlzaXMgYnkgc2ltdWxhdGlvbi4NCkluIFBhcnQgSSwgd2Ugc2F3IGhvdyB0byBkbyBhIHNpbXVsYXRpb24gZm9yIGEgc2ltcGxlIHRveS1leGFtcGxlIHdpdGggYSBjb2luLXRvc3MuDQpJbiB0aGlzIHBhcnQsIHdlIHdpbGwgdXNlIGEgbW9yZSByZWFsaXN0aWMgcHJvYmxlbSB0aGF0IHdlIG1pZ2h0IGVuY291bnRlciBpbiBvdXIgZGFpbHkgcmVzZWFyY2ggbGlmZSBhbmQgc2VlIGhvdyB0byBzaW11bGF0ZSB0aGUgcG93ZXIgZm9yIHRoZXNlIGRlc2lnbnMuDQpCeSBsb29raW5nIGF0IGhvdyB0byBkbyBwb3dlci1zaW11bGF0aW9uIGZvciB0aGUgaW5kZXBlbmRlbnQtc2FtcGxlcyB0LXRlc3QgYW5kIHRoZSBwYWlyZWQgdC10ZXN0IHdlIHdpbGwgbGVhcm4gaG93IHRvIHNpbXVsYXRlIG5vcm1hbC1kaXN0cmlidXRpb25zLCBob3cgdG8gc3BlY2lmeSB0aGVpciBlZmZlY3Qtc2l6ZXMsIGluIHRlcm1zIG9mICRDb2hlbidzXCBkJC4gTW9yZW92ZXIsIHdlIHNpbXVsYXRlIGNvcnJlbGF0ZWQgKGkuZS4gbXVsdGl2YXJpYXRlKSBub3JtYWwgZGlzdHJpYnV0aW9ucyBpbiBjYXNlcyB3aGVyZSB3ZSBoYXZlIGNvcnJlbGF0ZWQgb2JzZXJ2YXRpb25zIChlLmcuIHBhaXJlZC1zYW1wbGUgdC10ZXN0KS4NClRoaXMgd2lsbCBiZSBhbiBpbXBvcnRhbnQgdG9vbCBmb3IgbGF0ZXIgcGFydHMgb2YgdGhpcyB0dXRvcmlhbC4NCg0KSW4gcGFydCBJSUkgb2YgdGhpcyB0dXRvcmlhbCB3ZSB3aWxsIGxlYXJuIGhvdyB3ZSBjYW4gY29uY2VwdHVhbGl6ZSBiYXNpY2FsbHkgX2FueV8gZGVzaWduIGFzIGEgbGluZWFyIG1vZGVsIGFuZCB0aGVyZWJ5IGJlIHZlcnkgZmxleGlibGUgaW4gb3VyIHBvd2VyIGFuYWx5c2lzLg0KSW4gcGFydCBJViB3ZSB3aWxsIGxlYXJuIGhvdyB0byBhcHBseSB0aGlzIHRlY2huaXF1ZSB0byBjb21wbGljYXRlZCBkZXNpZ25zIHN1Y2ggYXMgbGluZWFyIG1peGVkLWVmZmVjdHMgbW9kZWxzIGFuZCBnZW5lcmFsaXplZCBtaXhlZC1lZmZlY3RzIG1vZGVscy4NCg0KDQojIyBTaW11bGF0aW5nIGEgYmV0d2Vlbi1zdWJqZWN0cyB0LXRlc3QNCg0KTGV0J3MgZ2V0IHRvIGl0Lg0KVGhlIGZpcnN0IHRoaW5nIHdlIHdpbGwgbmVlZCBhZ2FpbiBpbiBvdXIgc2ltdWxhdGlvbiBpcyBvbmUgb2YgdGhlIGltcGxlbWVudGVkIHNpbXVsYXRpb24gZnVuY3Rpb25zIGluIFIgKHRob3NlIHRoYXQgbGV0IGBSYCBydW4gdGhlb3JldGljYWwgZXhwZXJpbWVudHMgZm9yIHVzKSwgYnV0IHRoaXMgdGltZSBpdCBpcyBub3QgYHJiaW5vbWAgYXMgd2UgYXJlIG5vdCB3b3JraW5nIHdpdGggY29pbi1mbGlwcyBidXQgYHJub3JtYCAtIHRoZSBzaW11bGF0aW9uIGZ1bmN0aW9uIGZvciB0aGUgbm9ybWFsIGRpc3RyaWJ1dGlvbi4NCkxldCdzIGhhdmUgYSBzaG9ydCBsb29rIGF0IHRoYXQgZnVuY3Rpb24gYXMgd2Ugd2lsbCBrZWVwIHdvcmtpbmcgd2l0aCBpdCB0aHJvdWdob3V0IHRoZSB0dXRvcmlhbC4NCg0KYHJub3JtKG4sIG1lYW4sIHNkKWAgdGFrZXMgdGhyZWUgYXJndW1lbnRzLCBhIHNhbXBsZS1zaXplIGBuYCwgYSBgbWVhbmAgYW5kIGEgc3RhbmRhcmQtZGV2aWF0aW9uIGBzZGAuDQpCeSBzcGVjaWZ5aW5nIHRoZXNlIHZhbHVlcywgd2UgY2FuIHNhbXBsZSByYW5kb20gJ3Blb3BsZScgKG9yIG9ic2VydmF0aW9ucykgdGhhdCBhcmUgcGFydGljaXBhdGluZyBpbiBvdXIgc2ltdWxhdGVkIGV4cGVyaW1lbnRzLg0KSW1hZ2luZSwgZm9yIGV4YW1wbGUsIHRoYXQgd2UgaGF2ZSBhbiBpbnRlcnZlbnRpb24gc3R1ZHkgaW4gd2hpY2ggd2UgaGF2ZSBhIHRyZWF0bWVudCBncm91cCBhbmQgYSBjb250cm9sIGdyb3VwLg0KV2UgY2FuIGVhc2lseSBzaW11bGF0ZSBib3RoIGdyb3VwcyB3aXRoIGBybm9ybWAgYnV0IHdoYXQgc2hvdWxkIHRoZSBtZWFucyBhbmQgc2RzIG9mIHRoZSBncm91cHMgYmU/DQoNClRoZXJlIGFyZSB0d28gd2F5cyB3ZSBjYW4gYXBwcm9hY2ggdGhpcy4gDQoNCjEuIFdlIGNvdWxkIHRoaW5rIGFib3V0IHdoYXQgZ3JvdXAgbWVhbnMgd2UgZXhwZWN0IGluIG91ciBnaXZlbiBjYXNlIGFuZCB3aGF0IHdlIGV4cGVjdCB0aGUgc3ByZWFkIG9mIHRoZSBncm91cHMgdG8gYmUgX29uIHRoZSBtZWFzdXJtZW50IHNjYWxlIHRoYXQgd2UgYXJlIHdvcmtpbmcgd2l0aF8uDQpGb3IgZXhhbXBsZSwgaWYgd2UgdXNlIGEgNDAtcG9pbnQgc2NhbGUgZm9yIGEgY2xpbmljYWwgdGVzdCB3ZSBtaWdodCBrbm93IHRoYXQgYSBncm91cCB3aXRoIGRlZmljaWVuY2llcyBvbiB0aGUgdGhpbmcgdGhhdCB3ZSBtZWFzdXJlIHdvdWxkIHByb2JhYmx5IHNjb3JlIGFyb3VuZCAxMCBwb2ludHMgYW5kIHRoYXQgYWxtb3N0IGV2ZXJ5b25lIGZyb20gdGhhdCBncm91cCB3b3VsZCBzY29yZSBsb3dlciB0aGFuIDIwIHBvaW50cy4NClRoaXMgc3RhdGVtZW50IChtb3N0IHBlb3BsZSBzY29yZSBhcm91bmQgMTAsIGFsbW9zdCBldmVyeW9uZSBzY29yZXMgbG93ZXIgdGhhbiB0aWZpZWQgYXMgbm9ybWFsIGRpc3RyaWJ1dGlvbiB3aXRoIGEgbWVhbiBvZiAxMCBhbmQgYSBzdGFuZGFyZC1kZXZpYXRpb24gb2YgNS4gSW4gdGhpcyBjYXNlIG9ubHkgMi41JSBvZiB0aGUgdmFsdWVzIChpLmUuIHRoZSB2YWx1ZXMgb3V0c2lkZSB0aGUgOTUlIENJKSB3aWxsIGJlIGhpZ2hlciB0aGFuIDIwLg0KMS4gSW4gYSBuZXcgcmVzZWFyY2ggcHJvamVjdCwgd2UgbWlnaHQgbm90IGJlIGFibGUgb3Igd2lsbGluZyB0byB0byBtYWtlIHRoZXNlIHN0YXRlbWVudHMuIA0KSW4gdGhpcyBjYXNlLCBieSBtYWtpbmcgc29tZSBleHRyYSBhc3N1bXB0aW9ucywgd2UgY2FuIGZhbGwgYmFjayB0byB0aGUgYXBwcm9hY2ggdGhhdCB3ZSBhbHNvIHVzZSBpbiBwb3dlci1jYWxjdWxhdGlvbiBzb2Z0d2FyZSBpbiBtb3N0IGNhc2VzIGFuZCBkZWZpbmUgYSBfc3RhbmRhcmRpemVkIGVmZmVjdCBzaXplXyB0aGF0IHdlIGNhbiB1c2UgdG8gc2ltdWxhdGUgZGF0YSByYXRoZXIgdGhhbiBkZWZpbmluZyB0aGUgZ3JvdXAgbWVhbnMgYW5kIHN0YW5kYXJkLWRldmlhdGlvbnMgZGlyZWN0bHkuDQoNCkkgcGVyc29uYWxseSB0cnkgdG8gZ28gd2l0aCB0aGUgZmlyc3QgYXBwcm9hY2ggd2hlbmV2ZXIgcG9zc2libGUsIGFzIEkgdGhpbmsgdGhhdCBpbiBtYW55IGNhc2VzIHdlIGtub3cgbW9yZSBhYm91dCB3aGF0IHdlIGV4cGVjdCBmcm9tIG91ciBkYXRhIHRoYW4gd2UgdGhpbmssIGV2ZW4gaW4gbmV3IHByb2plY3RzLiANCkV2ZW4gaWYgd2UgX19kbyBub3RfXyBrbm93IGEgbG90IGFib3V0IG91ciBkYXRhLCB3ZSBtaWdodCBzdGlsbCB0cnkgb3V0IGRpZmZlcmVudCBhc3N1bXB0aW9ucyAoaS5lLiBtZWFucyBhbmQgc2RzKSBmb3IgdGhlIGdyb3VwcyBpbiBvdXIgc2ltdWxhdGlvbiB0byBzZWUgd2hhdCBwb3dlciB3ZSB3b3VsZCBnZXQgZm9yIGVhY2ggb2YgdGhlbS4NClRoaXMgd2F5LCB3ZSBjYW4gbWFrZSBpbmZvcm1lZCBkZWNpc2lvbnMgYWJvdXQgb3VyIHNhbXBsZSBzaXplIHRoYXQgYXJlIG1vcmUgbnVhbmNlZCB0aGFuIHRoZSBvbmUgaW4gd2hpY2ggd2UganVzdCBhc3N1bWUgYSBzdGFuZGFyZGl6ZWQgZWZmZWN0IHNpemUgYW5kIHNlZSB3aGF0IHNhbXBsZS1zaXplIGl0IGltcGxpZXMgYW5kIGFyZSBmb3JjZWQgdG8gdGhpbmsgaGFyZGVyIGFib3V0IG91ciBkYXRhIC0gc29tZXRoaW5nIHRoYXQgbWlnaHQgc2VlbSBkaWZmaWN1bHQgYW5kIGFubm95aW5nIGF0IGZpcnN0LCBidXQgaXMgZXh0cmVtZWx5IHVzZWZ1bCBhbmQgZWR1dWNhdGlvbmFsLg0KQW5vdGhlciBhZHZhbnRhZ2Ugb2Ygc3BlY2lmeWluZyB0aGUgZ3JvdXBzIGRpcmVjdGx5IGlzIHRoYXQgd2UgY2FuIGRvIHRoaXMgZm9yIGFueSBhcmJpdHJhcmlseSBjb21wbGV4IGRlc2lnbiB3aGVyZSBzdGFuZGFyZGl6ZWQgZWZmZWN0IHNpemVzIGFyZSBvZnRlbiBkaWZmaWN1bHQgdG8gY2FsY3VsYXRlLg0KDQpUaGlzIHNhaWQsIGZvciB0aGUgY2FzZXMgd2hlcmUgd2UgbWlnaHQgcmVhbGx5IG5vdCBiZSB3aWxsaW5nIHRvIHNwZWNpZnkgZ3JvdXBzIGRpcmVjdGx5LCBhbmQgYmVjYXVzZSBpdCBhbGxvd3MgbWUgdG8gZGVtb25zdHJhdGUgc29tZSBvdGhlciBpbnRlcmVzdGluZyBwb2ludHMsIGluIHRoaXMgcGFydCBJIHdpbGwgZGlzY3VzcyBob3cgd2UgY2FuIHVzZSBzdGFuZGFyZGl6ZWQgZWZmZWN0LXNpemVzIGluIG91ciBzaW11bGF0aW9uLg0KSW4gcGFydCBJSUkgYW5kIElWIGhvd2V2ZXIsIHdlIHdpbGwgYWx3YXlzIHNwZWNpZnkgZWZmZWN0cyBvbiB0aGUgcmF3IHNjYWxlLg0KDQoNCklmIHdlIHdlcmUgdXNpbmcgR1Bvd2VyIG5vdywgd2Ugd291bGQgbW9zdCBsaWtlbHkganVzdCBmaWxsIGluIGEgZGlmZmVyZW5jZSBiZXR3ZWVuIGdyb3VwcyBpbiAkQ29oZW4nc1wgZCQgYW5kIGJlIGRvbmUgd2l0aCBpdC4gDQpXZSBjb3VsZCBvZiBjb3Vyc2UgYWxzbyBmb2xsb3cgdGhpcyBhcHByb2FjIGluIGEgc2ltdWxhdGlvbiBieSBkZWZpbmluZyB0aGUgZ3JvdXBzIGJhc2VkIG9uIHRoZSBpbXBsaWVkICRDb2hlbidzXCBkJC4gDQpGb3IgaW5zdGFuY2UsIHdlIGNhbiBqdXN0IGFzc3VtZSB0aGF0IGdyb3VwIDEgYXMgYHJub3JtKG4sIDEsMilgLg0KTm93LCBmb2xsb3dpbmcgZnJvbSB0aGUgZm9ybXVsYSBmb3IgQ29oZW4ncyBkOg0KDQokJENvaGVuJ3NcIGQgPSAgXGZyYWN7KE1fMSAtIE1fMil9e3Bvb2xlZCBcIHNkfSQkDQoNCndoZXJlDQoNCiQkcG9vbGVkXCBzZCA9ICBcc3FydFxmcmFjeyhzZF8xXjIrc2RfMl4yKX17Mn0kJA0KIA0KIGFuZCBhZGhlcmluZyB0byB0aGUgc3R1ZGVudCB0LXRlc3QgYXNzdW1wdGlvbiBvZiBlcXVhbCB2YXJpYW5jZXMgd2UgY2FuIGZpbGwgaW4gdGhlIHBvb2xlZCBzZCBmb3JtdWxhIGFib3ZlIGFzDQoNCiQkcG9vbGVkXCBzZCA9ICBcc3FydFxmcmFjeygyXjIrMl4yKX17Mn0gPSAyJCQNCg0KdG8gZ2V0IGEgJENvaGVuJ3NcIGQkIG9mIC41MDoNCg0KJCRDb2hlbidzXCBkID0gIFxmcmFjeygxIC0gMCl9ezJ9ID0gMC41JCQNCg0KVG8gZ2V0IGFueSBvdGhlciB2YWx1ZSBmb3IgJENvaGVuJ3NcIGQkIHdlIGNhbiBqdXN0IGNoYW5nZSB0aGUgcG9vbGVkIHNkIHZhbHVlIHRvIHdoYXRldmVyIHdlIHdhbnQuDQpNb3JlIGdlbmVyYWxseSwgd2Ugd2FudCB0byBzb2x2ZSB0aGUgZXF1YXRpb24gYWJvdmUgZm9yIHRoZSBwb29sZWQgc2QgYWZ0ZXIgc3BlY2lmeWluZyBhbnkgJENvaGVuJ3NcIGQkLCBlLmcuOg0KDQokJDAuNT0gIFxmcmFjeygxIC0gMCl9e3Bvb2xlZFwgc2R9JCQNCg0KV2UgY2FuIHNvbHZlIGFuIGVxdWF0aW9uIGxpa2UgdGhhdCB3aXRoIGBSYCdzIHNvbWV3aGF0IHVuaW50dWl0aXZlIGBzb2x2ZWAgZnVuY3Rpb24gbGlrZSB0aGlzOg0KDQpgYGB7ciBzb2x2ZV9jb2hlbnNkfQ0Kc29sdmUoMC41LDEpICMgY29oZW5zIGQgb2YgLjUNCnNvbHZlKDAuMjUsMSkgIyBjb2hlbnMgZCBvZiAuMjUNCnNvbHZlKDIsMSkgIyBjb2hlbnMgZCBvZiAyDQoNCmBgYA0KDQpnaXZpbmcgdXMgdGhyZWUgZXhhbXBsZXMgb2YgaG93IHdlIHdvdWxkIG5lZWQgdG8gc3BlY2lmeSBwb29sZWQgc2QgdG8gYXJyaXZlIGF0IGEgcGFydGljdWxhciAkQ29oZW4nc1wgZCQuDQoNClRodXMsIGlmIHdlIHdhbnQgdG8gZG8gYSB0LXRlc3Qgd2l0aCB0d28gc2ltdWxhdGVkIGdyb3VwcyBhbmQgYSBjb2hlbidzIGQgb2YgMC41IHdlIGNhbiBzaW11bGF0ZSB0d28gZ3JvdXBzIG9mIGEgcGFydGljdWxhciBzYW1wbGUtc2l6ZSBieSB1c2luZyB0aGUgYHJub3JtYCBmdW5jdGlvbi4NCkxldCdzIHNheSB3ZSBoYXZlIDMwIHBhcnRpY2lwYW50cyBpbiBlYWNoIGdyb3VwLg0KDQpgYGB7ciBzaW1fZ3JvdXBzMX0NCnNldC5zZWVkKDEyMzQpDQpncm91cDEgPC0gcm5vcm0oMzAsIDEsIDIpDQpncm91cDIgPC0gcm5vcm0oMzAsIDAsIDIpDQpgYGANCg0KV2UgY2FuIHZpc3VhbGl6ZSB0aGUgZ3JvdXBzIHRoYXQgd2UgZ290IGluIGEgcGxvdCBsaWtlIHRoaXM6DQoNCmBgYHtyIHBsb3RfZ3JvdXBzMX0NCmhpc3QoZ3JvdXAxLCBjb2wgPSAiI2FkZGQ4ZSIsIGJyZWFrcyA9IDEwLCBtYWluID0gIkhpc3RvZ3JhbSBvZiBib3RoIGdyb3VwcyIsIHhsYWIgPSAiIikNCmhpc3QoZ3JvdXAyLCBhZGQgPSBUUlVFLCBicmVha3MgPSAxMCwgY29sPSAiIzMxYTM1NCIpDQpgYGANCg0KV2UgY2FuIGFscmVhZHkgbWFrZSBpbXBvcnRhbnQgb2JzZXJ2YXRpb25zIGZyb20gdGhpcyBwbG90Og0KDQpXZSB3YW50ZWQgdG8gZ2V0IG5vcm1hbCBkaXN0cmlidXRpb25zLCBidXQgd2hhdCB3ZSBnb3QgaGVyZSBkb2VzIG5vdCByZWFsbHkgbG9vayBub3JtYWwuIA0KV2h5IGlzIHRoYXQ/IEJlY2F1c2Ugd2Ugb25seSBoYXZlIDMwIHBlb3BsZSBwZXIgZ3JvdXAgYW5kIHRha2luZyBvbmx5IDMwIHZhbHVlcyBmcm9tIHRoZSBzcGVjaWZpZWQgbm9ybWFsIGRpc3RyaWJ1dGlvbnMgZG9lcyBub3QgcmVhbGx5IGdpdmUgdXMgYSBnb29kIGFwcHJveGltYXRpb24gb2YgdGhlIHJlYWwgZGlzdHJpYnV0aW9uLg0KX19UaGlzIHBvaW50IGlzIGltcG9ydGFudF9fOiBUaGUgc2FtcGxpbmcgdmFyaWFiaWxpdHkgaW4gc3VjaCBzbWFsbCBncm91cHMgaXMgaGlnaCBhbmQgb2Z0ZW4sIGlmIHNtYWxsIHNhbXBsZS1zdHVkaWVzIChpLmUuIHVuZGVycG93ZXJlZCBzdHVkaWVzKSBmaW5kICJlZmZlY3RzIiwgdGhleSBhcmUgb2Z0ZW4gcmF0aGVyIGJpZyBhbmQgdGhlIGNvbnNlcXVlbmNlIG9mIHRoaXMgc2FtcGxpbmcgdmFyaWFiaWxpdHkgcmF0aGVyIHRoYW4gcmVhbCBkaWZmZXJlbmNlcyBvZiBncm91cHMuDQpGb3IgZXhhbXBsZSwgYnkgbG9va2luZyBhdCB0aGUgbWVhbnMgb2Ygb3VyIHNhbXBsZWQgZ3JvdXBzIGBtZWFuKGdyb3VwMSlgID0gYHIgbWVhbihncm91cDEpYCBhbmQgYG1lYW4oZ3JvdXAyKWAgPSBgciBtZWFuKGdyb3VwMilgIHdlIHNlZSB0aGF0IHRoZSBncm91cCBtZWFuIG9mIGdyb3VwIDEgaXMgYWN0dWFsbHkgY2xvc2VyIHRvIHRoZSBtZWFuIHRoYXQgd2Ugc3BlY2lmaWVkIGZvciBncm91cCAyIChpLmUuIDApIHRoYW4gdG8gaXRzIG93biBtZWFuLCB3aGlsZSB0aGUgbWVhbiBmb3IgZ3JvdXAgMiBpcyBmYXIgYXdheSBmcm9tIG91ciBpbnRlbmRlZCBtZWFuLiANCkxvb2tpbmcgYXQgdGhlIHNkcyBhY3R1YWxseSBzaG93cyB0aGF0IHRoZXkgYXJlIHF1aXRlIGNsb3NlIHRvIHdoYXQgd2Ugd2FudGVkIGBzZChncm91cDEpYCA9IGByIHNkKGdyb3VwMSlgIGFuZCBgc2QoZ3JvdXAyKWAgPSBgciBzZChncm91cDIpYC4NClRoZSAkQ29oZW4nc1wgZCQgdGhhdCB3ZSB3YW50ZWQgaXMgYWxzbyBub3QgcHJlc2VudGVkIHZlcnkgYWNjdXJhdGVseSBhdCBgKG1lYW4oZ3JvdXAxKS1tZWFuKGdyb3VwMikpLyhzcXJ0KChzZChncm91cDEpXjIrc2QoZ3JvdXAyKV4yKS8yKSlgID0gYHIgKG1lYW4oZ3JvdXAxKS1tZWFuKGdyb3VwMikpLyhzcXJ0KChzZChncm91cDEpXjIrc2QoZ3JvdXAyKV4yKS8yKSlgLg0KQWdhaW4sIGlmIHdlIHdvdWxkIGRvIHRoaXMgaW4gR3Bvd2VyLCBhbmQgc3BlY2lmeSBhICRDb2hlbidzXCBkJCwgd2Ugd2lsbCBhbHdheXMgd29yayB3aXRoIGFuIF9leGFjdF8gJENvaGVuJ3NcIGQkLCBpbiBhIHNpbXVsYXRpb24gYXBwcm9hY2ggd2UgZG8gX19ub3RfXy4gDQoNCg0KU28gbGV0IHVzIHJ1biBhIHQtdGVzdCB0byBzZWUgd2hldGhlciB0aGVyZSBpcyBhIHNpZ25pZmljYW50IGRpZmZlcmVuY2UgaGVyZS4NCkZpcnN0LCB3ZSBuZWVkIHRvIGRlY2lkZSBvbiBhbiBhbHBoYS1sZXZlbCBhZ2Fpbi4NCldoYXQgd2lsbCB3ZSBjaG9vc2U/DQpXZWxsLCB0byBoYXZlIGEgZ29vZCBqdXN0aWZpY2F0aW9uIHdlIGhhdmUgdG8gZWxhYm9yYXRlIG9uIHdoYXQgdGhlIGdyb3VwcyBhY3R1YWxseSByZXByZXNlbnQuDQpMZXQgdXMgc2F5IHRoYXQgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBncm91cHMgaXMgcmVsYXRlZCB0byBhbiBpbnRlcnZlbnRpb24gdGhhdCBjYW4gZWxldmF0ZSBkZXByZXNzaXZlIHN5bXB0b21zLiANClRodXMsIHRoZSBjb250cm9sIGdyb3VwIChncm91cDEpIGRpZCBub3QgZ2V0IHRoZSBpbnRlcnZlbnRpb24gYW5kIHNjb3JlcyBoaWdoZXIgb24gZGVwcmVzc2l2ZSBzeW1wdG9tcyB3aGlsZSB0aGUgdHJlYXRtZW50IGdyb3VwIChncm91cDIpIGlzIGV4cGVjdGVkIHRvIHNjb3JlIGxvd2VyLg0KTGV0IHVzIGFzc3VtZSB0aGF0IHRoaXMgaXMgdGhlIGZpcnN0IHN0dWR5IHRoYXQgd2UgcnVuIGFuZCB0aGF0LCBpZiB3ZSBmaW5kIGFueXRoaW5nIHdlIHdpbGwgZm9sbG93IGl0IHVwIGJ5IG1vcmUgZXh0ZW5zaXZlIHN0dWRpZXMgYW55d2F5LiBUaGVyZWZvcmUsIHdlIG1pZ2h0IG5vdCB3YW50IHRvIG1pc3MgYSBwb3NzaWJsZSBlZmZlY3QgYnkgc2V0dGluZyBhIHRvbyBjb25zZXJ2YXRpdmUgYWxwaGEtbGV2ZWwuDQpJZiB3ZSBmaW5kIHNvbWV0aGluZyBpbiB0aGlzIHN0dWR5LCB3ZSB3aWxsIGNvbmR1Y3QgZnVydGhlciBzdHVkaWVzIGluIHdoaWNoIHdlIGFyZSBtb3JlIHN0cmljdCBhYm91dCB0aGUgYWxwaGEgbGV2ZWwuDQpUaHVzLCB3ZSBjaG9vc2UgLjEwIGZvciB0aGlzIGZpcnN0ICJwaWxvdCIgc3R1ZHkuDQoNCjxkaXYgY2xhc3MgPSAibm90ZWJveCI+DQo8cD4NCl9fTk9URV9fOiBUaGUgYWxwaGEtbGV2ZWwgImp1c2ZpY2ljYXRpb25zIiBpbiB0aGlzIHR1dG9yaWFsIGFyZSBmb3IgZWR1Y2F0aW9uYWwgcHVycG9zZXMgYW5kIHRvIHByb3ZpZGUgYSBzdGFydGluZyBwb2ludC4gVGhleSBhcmUgb2J2aW91c2x5IG5vdCBhcyByaWdvcm91cyBhcyB3ZSB3b3VsZCBsaWtlIGluIGEgcmVhbCByZXNlYXJjaCBwcm9qZWN0LiBJZiB5b3UgZmluZCB5b3Vyc2VsZiBpbiBhIHNpdHVhdGlvbiB3aGVyZSB5b3Ugd2FudCB0byBqdXN0aWZ5IHlvdXIgYWxwaGEtbGV2ZWwgc2VlIFtKdXN0aWZ5IHlvdXIgYWxwaGEgYnkgTGFrZW5zIGV0IGFsLl0oaHR0cHM6Ly93d3cubmF0dXJlLmNvbS9hcnRpY2xlcy9zNDE1NjItMDE4LTAzMTEteCkgZm9yIGEgZ29vZCBkaXNjdXNzaW9uIG9uIHRoaXMuDQo8L3A+DQo8L2Rpdj4NCg0KV2UgY2FuIG5vdyBydW4gYSB0LXRlc3Qgd2l0aCBSJ3MgaW50ZWdyYXRlZCBgdC50ZXN0YCBmdW5jdGlvbi4NCg0KYGBge3IgdC10ZXN0MX0NCnQudGVzdChncm91cDEsIGdyb3VwMiwgcGFpcmVkID0gRkFMU0UsIHZhci5lcXVhbCA9IFRSVUUsIGNvbmYubGV2ZWwgPSAwLjkpDQpgYGANCg0KVGhlIHQtdGVzdCBzaG93cywgdGhhdCB0aGlzIGVmZmVjdCB3b3VsZCBiZSBzaWduaWZpY2FudC4NCkhvd2V2ZXIsIHdlIGFsc28gZ290ICJsdWNreSIgYW5kIGhhZCBhIGxhcmdlciBlZmZlY3QgdGhhbiB3ZSBpbnRlbmRlZCB0byBoYXZlLg0KVG8gZG8gYSBwcm9wZXIgcG93ZXIgYW5hbHlzaXMgKGxldHMgc2F5IHdlIGZpcnN0IHdhbnQgdG8gc2VlIHdoZXRoZXIgMzAgcGVvcGxlIHBlciBncm91cCBhcmUgZW5vdWdoKSB3ZSBuZWVkIHRvIG5vdCBvbmx5IHNpbXVsYXRlIGVhY2ggZ3JvdXAgb25jZSwgYnV0IG1hbnkgbWFueSB0aW1lcyBhbmQgc2VlIGhvdyBvZnRlbiB3ZSBnZXQgYSBzaWduaWZpY2FudCByZXN1bHQgYXQgdGhlIGRlc2lyZWQgYWxwaGEtbGV2ZWxbXjFdLg0KTW9yZW92ZXIsIHdlIHdvdWxkIGxpa2UgdG8gaGF2ZSBhIHBvd2VyIG9mIGF0IGxlYXN0IDk1JSwgYWdhaW4gcmVmbGVjdGluZyBvdXIgdmlldyB0aGF0IHdlIGRvIG5vdCB3YW50IHRvIG1pc3MgYSBwb3NzaWJsZSBlZmZlY3QuDQoNCkluIG5vcm1hbCBsYW5ndWFnZSB0aGVzZSBhc3N1bXB0aW9ucyBtZWFuIHRoYXQgaWYgdGhlcmUgaXMgYSBkaWZmZXJlbmNlLCB3ZSB3aWxsIGRldGVjdCBpdCBpbiAxOSBvdXQgb2YgMjAgY2FzZXMgd2hpbGUsIGlmIHRoZXJlIGlzIG5vIGRpZmZlcmVuY2UsIHdlIHdpbGwgb25seSBiZSBpbmNvcnJlY3RseSBjbGFpbWluZyB0aGF0IHRoZXJlIGlzIG9uZSBpbiAxIG91dCBvZiAxMCBjYXNlcy4NCg0KV2Ugd2lsbCBkbyB0aGlzIHNpbWlsYXJseSB0byBvdXIgc2ltdWxhdGlvbnMgaW4gcGFydCAxIG9mIHRoaXMgdHV0b3JpYWwuDQoNCmBgYHtyIHNpbV90dGVzdF9wcDMwfQ0Kc2V0LnNlZWQoMSkNCm5fc2ltcyA8LSAxMDAwICMgd2Ugd2FudCAxMDAwIHNpbXVsYXRpb25zDQpwX3ZhbHMgPC0gYygpDQpmb3IoaSBpbiAxOm5fc2ltcyl7DQogIGdyb3VwMSA8LSBybm9ybSgzMCwxLDIpICMgc2ltdWxhdGUgZ3JvdXAgMQ0KICBncm91cDIgPC0gcm5vcm0oMzAsMCwyKSAjIHNpbXVsYXRlIGdyb3VwIDINCiAgcF92YWxzW2ldIDwtIHQudGVzdChncm91cDEsIGdyb3VwMiwgcGFpcmVkID0gRkFMU0UsIHZhci5lcXVhbCA9IFRSVUUsIGNvbmYubGV2ZWwgPSAwLjkwKSRwLnZhbHVlICMgcnVuIHQtdGVzdCBhbmQgZXh0cmFjdCB0aGUgcC12YWx1ZQ0KfQ0KbWVhbihwX3ZhbHMgPCAuMTApICMgY2hlY2sgcG93ZXIgKGkuZS4gcHJvcG9ydGlvbiBvZiBwLXZhbHVlcyB0aGF0IGFyZSBzbWFsbGVyIHRoYW4gYWxwaGEtbGV2ZWwgb2YgLjEwKQ0KDQpgYGANCg0KQWhhLCBzbyBpdCBhcHBlYXJzIHRoYXQgb3VyIHBvd2VyIGBtZWFuKHBfdmFscyA8IC4xMClgID0gYHIgbWVhbihwX3ZhbHMgPCAuMTApYCBpcyBtdWNoIGxvd2VyIHRoYW4gdGhlIDk1JSB0aGF0IHdlIGRlc2lyZWQuDQpUaHVzLCB3ZSBkaWQgcmVhbGx5IGdldCBsdWNreSBpbiBvdXIgZXhhbXBsZSBhYm92ZSB3aGVuIHdlIGZvdW5kIGFuIGVmZmVjdCBvZiBvdXIgaW50ZXJ2ZW50aW9uLg0KDQpUbyBhY3R1YWxseSBkbyBhIGxlZ2l0IHBvd2VyLWFuYWx5c2lzIGhvd2V2ZXIsIHdlIHdvdWxkIGxpa2UgdG8ga25vdyBob3cgbWFueSBwZW9wbGUgd2UgZG8gbmVlZCBmb3IgYSBwb3dlciBvZiA5NSBwZXJjZW50Lg0KQWdhaW4gd2UgY2FuIG1vZGlmeSB0aGUgY29kZSBhYm92ZSB0byB0YWtlIHRoaXMgaW50byBhY2NvdW50Lg0KDQpgYGB7ciB0X3Rlc3RfdHN9DQpzZXQuc2VlZCgxKQ0Kbl9zaW1zIDwtIDEwMDAgIyB3ZSB3YW50IDEwMDAgc2ltdWxhdGlvbnMNCnBfdmFscyA8LSBjKCkNCnBvd2VyX2F0X24gPC0gYygwKSAjIHRoaXMgdmVjdG9yIHdpbGwgY29udGFpbiB0aGUgcG93ZXIgZm9yIGVhY2ggc2FtcGxlLXNpemUgKGl0IG5lZWRzIHRoZSBpbml0aWFsIDAgZm9yIHRoZSB3aGlsZS1sb29wIHRvIHdvcmspDQpjb2hlbnNfZHMgPC0gYygpDQpjb2hlbnNfZHNfYXRfbiA8LSBjKCkgDQpuIDwtIDMwICMgc2FtcGxlLXNpemUgDQppIDwtIDINCndoaWxlKHBvd2VyX2F0X25baS0xXSA8IC45NSl7DQogIGZvcihzaW0gaW4gMTpuX3NpbXMpew0KICAgIGdyb3VwMSA8LSBybm9ybShuLDEsMikgIyBzaW11bGF0ZSBncm91cCAxDQogICAgZ3JvdXAyIDwtIHJub3JtKG4sMCwyKSAjIHNpbXVsYXRlIGdyb3VwIDINCiAgICBwX3ZhbHNbc2ltXSA8LSB0LnRlc3QoZ3JvdXAxLCBncm91cDIsIHBhaXJlZCA9IEZBTFNFLCB2YXIuZXF1YWwgPSBUUlVFLCBjb25mLmxldmVsID0gMC45KSRwLnZhbHVlICMgcnVuIHQtdGVzdCBhbmQgZXh0cmFjdCB0aGUgcC12YWx1ZQ0KICAgIGNvaGVuc19kc1tzaW1dIDwtIGFicygobWVhbihncm91cDEpLW1lYW4oZ3JvdXAyKSkvKHNxcnQoKHNkKGdyb3VwMSleMitzZChncm91cDIpXjIpLzIpKSkgIyB3ZSBhbHNvIHNhdmUgdGhlIGNvaGVucyBkcyB0aGF0IHdlIG9ic2VydmVkIGluIGVhY2ggc2ltdWxhdGlvbg0KICB9DQogICAgcG93ZXJfYXRfbltpXSA8LSBtZWFuKHBfdmFscyA8IC4xMCkgIyBjaGVjayBwb3dlciAoaS5lLiBwcm9wb3J0aW9uIG9mIHAtdmFsdWVzIHRoYXQgYXJlIHNtYWxsZXIgdGhhbiBhbHBoYS1sZXZlbCBvZiAuMTApDQogICAgY29oZW5zX2RzX2F0X25baV0gPC0gbWVhbihjb2hlbnNfZHMpICMgY2FsY3VsYXRlIG1lYW5zIG9mIGNvaGVucyBkcyBmb3IgZWFjaCBzYW1wbGUtc2l6ZQ0KICAgIG4gPC0gbisxICMgaW5jcmVhc2Ugc2FtcGxlLXNpemUgYnkgMQ0KICAgIGkgPC0gaSsxICMgaW5jcmVhc2UgaW5kZXggb2YgdGhlIHdoaWxlLWxvb3AgYnkgMSB0byBzYXZlIHBvd2VyIGFuZCBjb2hlbnMgZCB0byB2ZWN0b3INCn0NCnBvd2VyX2F0X24gPC0gcG93ZXJfYXRfblstMV0gIyBkZWxldGUgZmlyc3QgMCBmcm9tIHRoZSB2ZWN0b3INCmNvaGVuc19kc19hdF9uIDwtIGNvaGVuc19kc19hdF9uWy0xXSAjIGRlbGV0ZSBmaXJzdCBOQSBmcm9tIHRoZSB2ZWN0b3INCmBgYA0KDQpUaGUgbG9vcCBzdG9wcGVkIGF0IGEgc2FtcGxlLXNpemUgb2YgYG4tMWAgPSBgciBuLTFgIHBhcnRpY2lwYW50cyBwZXIgZ3JvdXAuDQpUaHVzIG1ha2UgYSBjb25jbHVzaW9uIGFib3V0IHRoZSBlZmZlY3RpdmVuZXNzIG9mIG91ciBpbnRlcnZlbnRpb24gYXQgdGhlIHNwZWNpZmllZCBhbHBoYS1sZXZlbCB3aXRoIHRoZSBkZXNpcmVkIHBvd2VyIHdlIG5lZWQgYHIgKG4tMSkqMmAgcGVvcGxlIGluIHRvdGFsLg0KDQpUbyB2aXN1YWxpemUgdGhlIHBvd2VyIHdlIGNhbiBwbG90IGl0IGFnYWluLCBqdXN0IGFzIGluIHRoZSBmaXJzdCBwYXJ0IG9mIHRoZSB0dXRvcmlhbC4NCg0KYGBge3IgcGxvdF9wb3dlcjF9DQpwbG90KDMwOihuLTEpLCBwb3dlcl9hdF9uLCB4bGFiID0gIk51bWJlciBvZiBwYXJ0aWNpcGFudHMgcGVyIGdyb3VwIiwgeWxhYiA9ICJQb3dlciIsIHlsaW0gPSBjKDAsMSksIGF4ZXMgPSBUUlVFKQ0KYWJsaW5lKGggPSAuOTUsIGNvbCA9ICJyZWQiKQ0KYGBgDQoNCkFnYWluLCB0aGlzIHBsb3Qgc2hvd3MgdXMgaG93IG91ciBwb3dlciB0byBkZXRlY3QgdGhlIGVmZmVjdCBzbG93bHkgaW5jcmVhc2VzIGlmIHdlIGluY3JlYXNlIHRoZSBzYW1wbGUtc2l6ZSB1bnRpbCBpdCByZWFjaGVzIG91ciBkZXNpcmVkIHBvd2VyLg0KDQoNClRoZXJlIGlzIGFub3RoZXIgaW50ZXJlc3Rpbmcgb2JzZXJ2YXRpb24gdG8gbWFrZSBoZXJlLiANCkluIHRoZSBjb2RlIGFib3ZlLCBJIGFsc28gY2FsY3VsYXRlIHRoZSBhdmVyYWdlICRDb2hlbidzXCBkJCBmb3IgZWFjaCBzYW1wbGUgc2l6ZSBhbmQgdGhlIHBsb3QgYmVsb3cgc2hvd3MgaG93IGl0IGNoYW5nZXMgd2l0aCBpbmNyZWFzaW5nIHNhbXBsZS1zaXplLg0KDQpgYGB7ciBwbG90X2NvaGVuc2QxfQ0KcGxvdCgzMDoobi0xKSwgY29oZW5zX2RzX2F0X24sIHhsYWIgPSAiTnVtYmVyIG9mIHBhcnRpY2lwYW50cyBwZXIgZ3JvdXAiLCB5bGFiID0gIkNvaGVucyBEIiwgeWxpbSA9IGMoMC40NSwwLjU1KSwgYXhlcyA9IFRSVUUpDQphYmxpbmUoaCA9IC41MCwgY29sID0gInJlZCIpDQpgYGANCg0KSXQgaXMgbm90IHN1cGVyIG9idmlvdXMgaW4gdGhpcyBwbG90IGFuZCBJIGhhZCB0byBjaGFuZ2UgdGhlIHNjYWxlIG9mIHRoZSB5LWF4aXMgcXVpdGUgYSBiaXQgdG8gbWFrZSBpdCB2aXNpYmxlLCBidXQgd2UgY2FuIGFjdHVhbGx5IHNlZSBob3cgb3VyIGF2ZXJhZ2UgJENvaGVuJ3NcIGQkIGluaXRpYWxseSBkZXZpYXRlcyBzbGlnaHRseSBtb3JlIGZyb20gdGhlIGRlc2lyZWQgJENvaGVuJ3NcIGQkIG9mIC41MCB0aGFuIGluIGRlIGVuZC4NCkluIG90aGVyIHdvcmRzLCBpbiB0aGUgYmVnaW5uaW5nLCBmb3Igc21hbGwgc2FtcGxlLXNpemVzIHRoZXJlIGlzIG1vcmUgZmx1Y3R1YXRpb24gdGhhbiBmb3IgYmlnZ2VyIHNhbXBsZS1zaXplcy4NClRoYXQgaXMgcHJldHR5IG5lYXQsIGFzIGl0IHNlZW1zIHZlcnkgZGVzaXJhYmxlIHRoYXQgYSBwb3dlci1lc3RpbWF0aW9uIHByb2NlZHVyZSB0YWtlcyBpbnRvIGFjY291bnQgdGhhdCBmb3Igc21hbGxlciBzYW1wbGUtc2l6ZXMsIGV2ZW4gaWYgdGhlIGVmZmVjdCBpbiB0aGUgcG9wdWxhdGlvbiBpcyBleGFjdGx5IHRoZSBzYW1lIChpLmUuIHdlIGFsd2F5cyBzYW1wbGUgZ3JvdXBzIHdpdGggYSBkaWZmZXJlbmNlIG9mICRDb2hlbidzXCBkJCA9IC41MCkgaXQgaXMganVzdCBsZXNzIHByZWNpc2UuDQoNCg0KTGV0J3MgaGF2ZSBhIGJyaWVmIHN1bW1hcnkgb2Ygd2hhdCB3ZSBkaWQgc28gZmFyLg0KV2UganVzdCB1c2VkIHRoZSBmb3JtdWxhIGZvciAkQ29oZW4nc1wgZCQgdG8gZ2l2ZSBvdXIgZ3JvdXBzIGEgY2VydGFpbiBkaWZmZXJlbmNlIHRoYXQgd2UgYXJlIGludGVyZXN0ZWQgaW4sIHJhbiAxMDAwIHNpbXVsYXRlZCBleHBlcmltZW50cyBmb3IgZWFjaCBzYW1wbGUtc2l6ZSBhbmQgY2FsY3VsYXRlZCB0aGUgcG93ZXIsIGp1c3QgYXMgaW4gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIHR1dG9yaWFsLg0KDQpIb3dldmVyLCBJIHdhbnQgdG8gbWVudGlvbiBhZ2FpbiB0aGF0LCBldmVuIHRob3VnaCBpdCBpcyBjb252ZW5pZW50IHRvIHNwZWNpZnkgdGhlIGVmZmVjdC1zaXplIHRoaXMgd2F5IGFzIGl0IHNhdmVzIHVzIGZyb20gaGF2aW5nIHRvIHNwZWNpZnkgcHJlY2lzZSBncm91cCBtZWFucyBhbmQgc3RhbmRhcmQtZGV2aWF0aW9ucyBkaXJlY3R5IGFuZCBtYWtlcyB0aGUgc3BlY2lmaWNhdGlvbiBtb3JlIGNvbXBhcmFibGUsIGl0IGlzIG9mdGVuIHByZWZlcmFibGUgdG8gc3BlY2lmeSB0aGUgcGFyYW1ldGVycyBvbiB0aGUgb3JpZ2luYWwgc2NhbGUgdGhhdCB3ZSBhcmUgaW50ZXJlc3RlZCBpbi4NClRoaXMgaXMgZXNwZWNpYWxseSB0aGUgY2FzZSBpZiB3ZSBoYXZlIHByZXZpb3VzIGRhdGEgb24gYSByZXNlYXJjaCB0b3BpYyB0aGF0IHdlIGNhbiBtYWtlIHVzZSBvZi4gDQpNb3Jlb3ZlciwgZm9yIG1vcmUgY29tcGxleCBkZXNpZ25zIHdpdGggbWFueSBwYXJhbWV0ZXJzLCBzdGFuZGFyZGl6ZWQgZWZmZWN0IHNpemVzIGFyZSBvZnRlbiBkaWZmaWN1bHQgdG8gb2J0YWluIGFuZCB3ZSBhcmUgZm9yY2VkIHRvIG1ha2Ugb3VyIGFzc3VtcHRpb25zIG9uIHRoZSBvcmlnaW5hbCBzY2FsZSBvZiB0aGUgZGF0YS4NCldlIHdpbGwgc2VlIHRoaXMgaW4gbGF0ZXIgZXhhbXBsZXMuDQoNCg0KIyMgU2ltdWxhdGluZyBhIHdpdGhpbi1zdWJqZWN0IHQtdGVzdA0KDQpJbnR1aXRpdmVseSwgaXQgbWlnaHQgc2VlbSB0aGF0IHdlIGNhbiB1c2UgdGhlIGV4YWN0IHNhbWUgYXBwcm9hY2ggYWJvdmUgZm9yIGEgcGFpcmVkIHQtdGVzdCBhcyB3ZWxsLiANCkhvd2V2ZXIsIHRoZSBwcm9ibGVtIHdpdGggdGhpcyBpcyB0aGF0IGluIGEgcGFpcmVkIHQtdGVzdCB3ZSBnZXQgMiBkYXRhLXBvaW50cyBmcm9tIHRoZSBzYW1lIGluZGl2aWR1YWwuIA0KRm9yIGV4YW1wbGUsIGltYWdlIHdlIGhhdmUgYSBncm91cCBvZiBwZW9wbGUgdGhhdCBnZXQgYW4gaW50ZXJ2ZW50aW9uIGFuZCB3ZSBtZWFzdXJlIHRoZWlyIHNjb3JlIGJlZm9yZSBhbmQgYWZ0ZXIgdGhlIGludGVydmVudGlvbiBhbmQgd2FudCB0byBjb21wYXJlIHRoZW0gd2l0aCBhIHBhaXJlZCB0LXRlc3QuDQpJbiB0aGlzIGNhc2UsIHRoZSBzY29yZSBvZiB0aGUgcG9zdC1tZWFzdXJlIG9mIGEgZ2l2ZW4gaW5kaXZpZHVhbCBpcyBub3QgY29tcGxldGVseSBpbmRlcGVuZGVudCBvZiB0aGUgc2NvcmUgb2YgdGhlIHByZS1tZWFzdXJlLiANCkluIG90aGVyIHdvcmRzLCBzb21lYm9keSB3aG8gc2NvcmVzIHZlcnkgbG93IG9uIHRoZSBwcmUtbWVhc3VyZSB3aWxsIG1vc3QgbGlrZWx5IG5vdCBzY29yZSB2ZXJ5IGhpZ2ggb24gdGhlIHBvc3QtbWVhc3VyZSBhbmQgdmljZSB2ZXJzYS4NCg0KVGh1cywgdGhlcmUgaXMgYSBfY29ycmVsYXRpb25fIGJldHdlZW4gdGhlIHByZS0gYW5kIHRoZSBwb3N0LW1lYXN1cmVzIGluIHRoYXQgdGhlIHByZS1tZWFzdXJlcyBhbHJlYWR5IHRlbGwgdXMgYSBsaXR0bGUgYml0IGFib3V0IHdoYXQgd2UgY2FuIGV4cGVjdCBvbiB0aGUgcG9zdC1tZWFzdXJlLg0KWW91IHByb2JhYmx5IGFscmVhZHkga25ldyB0aGlzIGJ1dCB3aHkgZG9lcyB0aGlzIG1hdHRlciBmb3IgcG93ZXIgc2ltdWxhdGlvbiwgeW91IG1pZ2h0IHdvbmRlci4gDQpJdCBtYXR0ZXJzIGFzIGl0IGRpcmVjdGx5IGluZmx1ZW5jZXMgb3VyIHBvd2VyIHRvIGRldGVjdCBhbiBlZmZlY3QgYXMgd2Ugd2lsbCBzZWUgbGF0ZXIuDQpGb3Igbm93IGxldCdzIGp1c3Qga2VlcCBpbiBtaW5kIHRoYXQgaXQgaXMgaW1wb3J0YW50Lg0KDQoNClNvIHdoYXQgZG8gd2UgZG8gaW4gYSBzaXR1YXRpb24gd2l0aCBjb3JyZWxhdGVkIGRhdGEgYXMgaW4gdGhlIHByZS1wb3N0IGludGVydmVudGlvbiBzaXR1YXRpb24/DQpUaGVyZSBhcmUgdHdvIHdheXMgd2UgY2FuIGdvIGZyb20gaGVyZS4gDQpGaXJzdCwgd2UgY2FuIHNpbXVsYXRlIGNvcnJlbGF0ZWQgbm9ybWFsIGRpc3RyaWJ1dGlvbnMsIGFzIGFscmVhZHkgbWVudGlvbmVkIGFib3ZlLg0KSG93ZXZlciwgZm9yIHRoZSBwYXJ0aWN1bGFyIGNhc2Ugb2YgYSBwYWlyZWQgc2FtcGxlIHQtdGVzdCwgd2UgY2FuIGFsc28ganVzdCBtYWtlIHVzZSBvZiB0aGUgZmFjdCB0aGF0LCBpbiB0aGUgZW5kLCB3ZSBhcmUgdGVzdGluZyB3aGV0aGVyIHRoZSBfX2RpZmZlcmVuY2VfXyBiZXR3ZWVuIHBvc3QtIGFuZCBwcmUtbWVhc3VyZXMgaXMgZGlmZmVyZW50IGZyb20gMC4gDQpJbiB0aGlzIGNhc2UsIHRoZSBjb3JyZWxhdGlvbiBiZXR3ZWVuIHRoZSBwcmUgYW5kIHRoZSBwb3N0LW1lYXN1cmUgaXMgaW1wbGljaXRlbHkgaGFuZGxlZCB3aGVuIHN1YnN0cmFjdGluZyB0aGUgdHdvIG1lYXN1cmVzLiBUaGlzIHdheSwgd2UgZG8gbm90IG5lZWQgdG8gZGlyZWN0bHkgc3BlY2lmeSBpdC4gDQpJZiB0aGUgY29ycmVsYXRpb24gaXMgY2xvc2UgdG8gb25lLCB0aGUgc3RhbmRhcmQtZGV2aWF0aW9uIG9mIHRoZSBkaWZmZXJlbmNlIHNjb3JlcyB3aWxsIGJlIHZlcnkgc21hbGwsIGlmIGl0IGlzIHplcm8sIHdlIHdpbGwgZW5kIHVwIHdpdGggdGhlIHNhbWUgc2l0dWF0aW9uIHRoYXQgd2UgaGF2ZSBpbiB0aGUgaW5kZXBlbmRlbnQtc2FtcGxlIHQtdGVzdC4NClRodXMsIHdlIGNhbiBqdXN0IG1ha2UgdXNlIG9mIGEgb25lLXNhbXBsZSBpbiB3aGljaCB3ZSB0ZXN0IHdoZXRoZXIgdGhlIGRpc3RyaWJ1dGlvbiBvZiBkaWZmZXJlbmNlLXNjb3JlcyBkaWZmZXJzIGZyb20gemVybyBhcyB0aGUgcGFpcmVkIHQtdGVzdCBpcyBlcXVpdmFsZW50IHRvIHRoZSBvbmUtc2FtcGxlIHQtdGVzdCBvbiBkaWZmZXJlbmNlIHNjb3JlcyBbKHNlZSBMYWtlbnMsIDIwMTMgZm9yIG1vcmUgZGV0YWlscyBvbiB0aGlzKV0oaHR0cHM6Ly93d3cubmNiaS5ubG0ubmloLmdvdi9wbWMvYXJ0aWNsZXMvUE1DMzg0MDMzMS8pLg0KDQpUaG91Z2ggdGhlIG9uZS1zYW1wbGUgYXBwcm9hY2ggaXMgZWFzaWVyIHRvIHNpbXVsYXRlLCBJIHdpbGwgZGVzY3JpYmUgYm90aCBhcHByb2FjaGVzIGluIHRoZSBmb2xsb3dpbmcgYXMgdGhlIGZpcnN0IGFwcHJvYWNoIChzaW11bGF0aW5nIGNvcnJlbGF0ZWQgbm9ybWFsLWRpc3RyaWJ1dGlvbnMpIGlzIG1vcmUgZmxleGlibGUgYW5kIHdlIG5lZWQgaXQgZm9yIHRoZSBzaXR1YXRpb25zIHdlIGRlYWwgd2l0aCBsYXRlci4NCg0KIyMjIFVzaW5nIGEgb25lLXNhbXBsZSB0LXRlc3QgYXBwcm9hY2gNCg0KV2hlbiB3ZSB3YW50IHRvIGRvIG91ciBwb3dlci1jYWxjdWxhdGlvbiBiYXNlZCBvbiB0aGUgb25lLXNhbXBsZSB0LXRlc3QgYXBwcm9hY2gsIHdlIG9ubHkgaGF2ZSB0byBzcGVjaWZ5IGEgc2luZ2xlIGRpZmZlcmVuY2Utc2NvcmUgZGlzdHJpYnV0aW9uLg0KV2UgY2FuIGRvIHRoaXMgYWdhaW4sIGJhc2VkIG9uIHRoZSAkQ29oZW4nc1wgZCQgZm9ybXVsYSwgdGhpcyB0aW1lIGZvciBhIG9uZS1zYW1wbGUgc2NlbmFyaW86DQoNCiQkIENvaGVuJ3NcIGQgPSBcZnJhY3tNX3tkaWZmfSAtIFxtdV8wfXtTRF97ZGlmZn19JCQNCg0KSW4gdGhlIGFib3ZlIGZvcm11bGEsIHRvIGdldCBvdXIgdmFsdWVzIGZvciB0aGUgc2ltdWxhdGlvbiB3ZSBjYW4gc3Vic3RpdHV0ZSB0aGUgJFxtdV8wJCBieSAwIChhcyBvdXIgbnVsbC1oeXBvdGhlc2lzIGlzIG5vIGRpZmZlcmVuY2UpIGFuZCBzb2x2ZSB0aGUgZXF1YXRpb24gaW4gdGhlIHNhbWUgd2F5IGFzIGFib3ZlIGJ5IGZpeGluZyB0aGUgbWVhbi1kaWZmZXJlbmNlIGJldHdlZW4gcHJlLSBhbmQgcG9zdC1tZWFzdXJlLCAkTV97ZGlmZn0kIHRvIDEgYW5kIGNhbGN1bGF0aW5nIHRoZSBzZCB3ZSBuZWVkIGZvciBlYWNoIGdpdmVuICRDb2hlbidzXCBkJCwgZm9yIGluc3RhbmNlDQoNCiQkIDAuNSA9IFxmcmFjezF9e1NEX3tkaWZmfX0kJA0KDQpwdXR0aW5nIHRoaXMgaW50byBgUmBzIGBzb2x2ZWAgZnVuY3Rpb24gYWdhaW4sIHdlIHVuc3VycHJpc2luZ2x5IGdldCBhIDIgaW4gdGhpcyBjYXNlLg0KDQpgYGB7ciB9DQpzb2x2ZSgwLjUsIDEpDQpgYGANCg0KVG8gcnVuIG91ciBzaW11bGF0aW9uIHdlIGp1c3QgbmVlZCB0byBtb2RpZnkgdGhlIGNvZGUgYWJvdmUgdG8gcnVuIGEgb25lLXNhbXBsZSB0LXRlc3QgcmF0aGVyIHRoYW4gYSB0d28tc2FtcGxlIHQtdGVzdCBhbmQgY2hhbmdlIHRoZSBmb3JtdWxhIGZvciAkQ29oZW4nc1wgZCQNCg0KYGBge3IgdC10ZXN0X29zdH0NCnNldC5zZWVkKDEpDQpuX3NpbXMgPC0gMTAwMCAjIHdlIHdhbnQgMTAwMCBzaW11bGF0aW9ucw0KcF92YWxzIDwtIGMoKQ0KcG93ZXJfYXRfbiA8LSBjKDApICMgdGhpcyB2ZWN0b3Igd2lsbCBjb250YWluIHRoZSBwb3dlciBmb3IgZWFjaCBzYW1wbGUtc2l6ZSAoaXQgbmVlZHMgdGhlIGluaXRpYWwgMCBmb3IgdGhlIHdoaWxlLWxvb3AgdG8gd29yaykNCmNvaGVuc19kcyA8LSBjKCkNCmNvaGVuc19kc19hdF9uIDwtIGMoKSANCm4gPC0gMiAjIHNhbXBsZS1zaXplIA0KaSA8LSAyDQp3aGlsZShwb3dlcl9hdF9uW2ktMV0gPCAuOTUpew0KICBmb3Ioc2ltIGluIDE6bl9zaW1zKXsNCiAgICBkaWZmZXJlbmNlIDwtIHJub3JtKG4sMSwyKSAjIHNpbXVsYXRlIHRoZSBkaWZmZXJlbmNlIHNjb3JlIGRpc3RyaWJ1dGlvbg0KICAgIHBfdmFsc1tzaW1dIDwtIHQudGVzdChkaWZmZXJlbmNlLCBtdSA9IDAsIGNvbmYubGV2ZWwgPSAwLjkwKSRwLnZhbHVlICMgcnVuIHQtdGVzdCBhbmQgZXh0cmFjdCB0aGUgcC12YWx1ZQ0KICAgIGNvaGVuc19kc1tzaW1dIDwtIG1lYW4oZGlmZmVyZW5jZSkvc2QoZGlmZmVyZW5jZSkgIyB3ZSBhbHNvIHNhdmUgdGhlIGNvaGVucyBkcyB0aGF0IHdlIG9ic2VydmVkIGluIGVhY2ggc2ltdWxhdGlvbiANCiAgfQ0KICAgIHBvd2VyX2F0X25baV0gPC0gbWVhbihwX3ZhbHMgPCAuMTApICMgY2hlY2sgcG93ZXIgKGkuZS4gcHJvcG9ydGlvbiBvZiBwLXZhbHVlcyB0aGF0IGFyZSBzbWFsbGVyIHRoYW4gYWxwaGEtbGV2ZWwgb2YgLjEwKQ0KICAgIGNvaGVuc19kc19hdF9uW2ldIDwtIG1lYW4oY29oZW5zX2RzKSAjIGNhbGN1bGF0ZSBtZWFucyBvZiBjb2hlbnMgZHMgZm9yIGVhY2ggc2FtcGxlLXNpemUNCiAgICBuIDwtIG4rMSAjIGluY3JlYXNlIHNhbXBsZS1zaXplIGJ5IDENCiAgICBpIDwtIGkrMSAjIGluY3JlYXNlIGluZGV4IG9mIHRoZSB3aGlsZS1sb29wIGJ5IDEgdG8gc2F2ZSBwb3dlciBhbmQgY29oZW5zIGQgdG8gdmVjdG9yDQp9DQpwb3dlcl9hdF9uIDwtIHBvd2VyX2F0X25bLTFdICMgZGVsZXRlIGZpcnN0IDAgZnJvbSB0aGUgdmVjdG9yDQpjb2hlbnNfZHNfYXRfbiA8LSBjb2hlbnNfZHNfYXRfblstMV0gIyBkZWxldGUgZmlyc3QgTkEgZnJvbSB0aGUgdmVjdG9yDQpgYGANCg0KV2Ugc2VlIHRoYXQgdGhlIGxvb3Agc3RvcHBlZCBhdCBgbmAgPSBgciBuYCBzbyB0aGUgc2FtcGxlIHNpemUgd2UgbmVlZCBpcyBgbi0xYCA9IGByIG4tMWANCg0KV2UgY2FuIHBsb3QgdGhlIHBvd2VyLWN1cnZlIGFnYWluDQoNCmBgYHtyIHBsb3RfcG93ZXJfb3N0fQ0KcGxvdCgyOihuLTEpLCBwb3dlcl9hdF9uLCB4bGFiID0gIk51bWJlciBvZiBwYXJ0aWNpcGFudHMgcGVyIGdyb3VwIiwgeWxhYiA9ICJQb3dlciIsIHlsaW0gPSBjKDAsMSksIGF4ZXMgPSBUUlVFKQ0KYWJsaW5lKGggPSAuOTUsIGNvbCA9ICJyZWQiKQ0KYGBgDQoNCmFuZCB0aGUgJENvaGVuJ3NcIGQkIHZhbHVlczoNCg0KYGBge3IgcGxvdF9jb2hlbnNkX29zdH0NCnBsb3QoMjoobi0xKSwgY29oZW5zX2RzX2F0X24sIHhsYWIgPSAiTnVtYmVyIG9mIHBhcnRpY2lwYW50cyBwZXIgZ3JvdXAiLCB5bGFiID0gIkNvaGVucyBEIiwgeWxpbSA9IGMoMC4wLDEuMCksIGF4ZXMgPSBUUlVFKQ0KYWJsaW5lKGggPSAuNTAsIGNvbCA9ICJyZWQiKQ0KYGBgDQoNCldlIHNlZSBhZ2FpbiwgYW5kIHRoaXMgdGltZSBtb3JlIGRyYW1hdGljYWxseSwgaG93IG91ciBzaW11bGF0ZWQgZWZmZWN0IHNpemUgYmVjb21lcyBtb3JlIGFjY3VyYXRlIHRoZSBiaWdnZXIgb3VyIHNhbXBsZSBnZXRzLg0KDQoNCiMjIyBVc2luZyBhIGNvcnJlbGF0ZWQtc2FtcGxlcyBwYWlyZWQgdC10ZXN0IGFwcHJvYWNoDQoNCg0KIyMjIyBUaGUgcmVsYXRpb25zaGlwIGJldHdlZW4gJFNEX3tkaWZmfSQgYW5kIHRoZSBjb3JyZWxhdGlvbg0KDQpJbiB0aGUgYWJvdmUgZXhhbXBsZSwgd2UgcmVzcGVjaWZpZWQgYSBwYWlyZWQgdC10ZXN0IGFzIGEgb25lLXNhbXBsZSB0LXRlc3Qgb24gdGhlIGRpZmZlcmVuY2Ugc2NvcmVzLg0KSG93ZXZlciwgd2hhdCB3ZSBhcmUgYWN0dWFsbHkgd29ya2luZyB3aXRoIGlzIHR3byBfY29ycmVsYXRlZF8gZGlzdHJpYnV0aW9ucyBvZiBtZWFzdXJlbWVudHMuDQpUbyBkZW1vbnN0cmF0ZSB0aGlzIHBvaW50LCBsZXQgdXMgaGF2ZSBhIGxvb2sgYXQgaG93IHdlIHdvdWxkIGFjdHVhbGx5IGNhbGN1bGF0ZSB0aGUgc3RhbmRhcmQgZGV2aWF0aW9uIG9mIHRoZSBkaWZmZXJlbmNlIHNjb3JlcyAoJFNEX3tkaWZmfSQpIGluIHRoZSBhYm92ZSBlcXVhdGlvbiBmb3IgJENvaGVuJ3NcIGQkLg0KVGhlIGZvcm11bGEgdG8gY2FsY3VsYXRlICRTRF97ZGlmZn0kIGZyb20gdGhlIHN0YW5kYXJkIGRldmlhdGlvbiBvZiB0aGUgdHdvIG1lYXN1cmVtZW50cyAocHJlIGFuZCBwb3N0KSBhbmQgdGhlaXIgY29ycmVsYXRpb24gaXM6DQoNCiQkU0Rfe2RpZmZ9ID0gXHNxcnR7U0Rfe3ByZX1eMitTRF97cG9zdH1eMi0yciBcdGltZXMgU0Rfe3ByZX0gXHRpbWVzIFNEX3twb3N0fX0gJCQNCg0KSXQgaXMgbm90IGltcG9ydGFudCBhdCB0aGlzIHBvaW50IHRvIHVuZGVyc3RhbmQgd2h5IHRoaXMgaXMgdGhlIGNhc2UgKHdlIHdpbGwganVzdCB0cnVzdCBbQ29oZW5dKGh0dHA6Ly93d3cudXRzdGF0LnRvcm9udG8uZWR1L35icnVubmVyL29sZGNsYXNzLzM3OGYxNi9yZWFkaW5ncy9Db2hlblBvd2VyLnBkZikgb24gdGhpcykgYnV0IHNlZSBob3cgd2UgY2FuLCBmb3IgYW55IGdpdmVuICRTRF97ZGlmZn0kIGFuZCBhc3N1bWluZyBib3RoIGdyb3VwcyBoYXZlLCBmb3IgZXhhbXBsZSwgYSBzdGFuZGFyZCBkZXZpYXRpb24gb2YgMiwgc29sdmUgdGhlIGZvcm11bGEgdG8gc2VlIHdoYXQgY29ycmVsYXRpb24gKHRoZSAkciQgaW4gdGhlIGFib3ZlIGZvcm11bGEpIGl0IHdvdWxkIGltcGx5Lg0KDQoNCkltYWdpbmUsIGZvciBpbnN0YW5jZSwgd2UgYXNzdW1lIChsaWtlIGluIHRoZSBpbmRlcGVuZGVudC1zYW1wbGVzIHQtdGVzdCBhYm92ZSkgdGhhdCBib3RoIG1lYXN1cmVzIGhhdmUgYSBzdGFuZGFyZC1kZXZpYXRpb24gb2YgMiBhbmQgdGhhdCB0aGUgc3RhbmRhcmQtZGV2aWF0aW9uIG9mIHRoZSBkaWZmZXJlbmNlIHNjb3JlcyB3b3VsZCBhbHNvIGJlIDIgc28gdGhhdCB3ZSB3b3VsZCBoYXZlIHRoZSBzYW1lIHNpdHVhdGlvbiBhcyBpbiB0aGUgb25lLXNhbXBsZSB0LXRlc3QgZXhhbXBsZSBhYm92ZSwgd2hlcmUgd2UgaGFkIGEgbWVhbi1kaWZmZXJlbmNlIG9mIDEgYW5kIGEgZGlmZmVyZW5jZS1zY29yZSBzdGFuZGFyZC1kZXZpYXRpb24gb2YgMi4NCg0KRmlsbGluZyB0aGlzIGluIHdlIGdldCANCg0KJCQyID0gXHNxcnR7Ml4yKzJeMi0yciBcdGltZXMgMiBcdGltZXMgMn0gJCQNCg0KU29sdmluZyB0aGlzIGVxdWF0aW9uIGZvciAkciQsIHdlIGdldFteMl0gJHIgPSAwLjUkOg0KDQpUaGVyZWZvcmUsIGludGVyZXN0aW5nbHkgdGhlIHNpdHVhdGlvbiBpbiB3aGljaCB3ZSB1c2UgdGhlIHNhbWUgZ3JvdXBzIGFzIGFib3ZlIGFuZCBhc3N1bWUgdGhhdCB3ZSB3b3VsZCBnZXQgdGhlIHNhbWUgJFNEX3tkaWZmfSQgb2YgMiBhcyB3ZSBhc3N1bWVkIGluIG91ciBvbmUtc2FtcGxlIHNpdHVhdGlvbiB3b3VsZCBpbXBseSB0aGF0IHRoZSBjb3JyZWxhdGlvbiBiZXR3ZWVuIHRoZSBwcmUtIGFuZCB0aGUgcG9zdC1tZWFzdXJlIGlzICRyID0gMC41JC4NCldoYXQgZG9lcyB0aGlzIG1lYW4/IA0KV2VsbCwgbGV0cyBzZWUgd2hhdCBoYXBwZW5zIGlmIHdlIGFzc3VtZSBhIGNvcnJlbGF0aW9uIG9mICRyID0gLjkwJCBhbmQgc2VlIHdoYXQgJFNEX3tkaWZmfSQgd2UgZ2V0Og0KDQokJFNEX3tkaWZmfSA9IFxzcXJ0ezJeMisyXjItMiBcdGltZXMgMC45MCBcdGltZXMgMiBcdGltZXMgMn0gJCQNCg0KU29sdmluZyB0aGlzIGluIGBSYCBnaXZlcyB1czogYHNxcnQoMl4yKzJeMi0yKjAuOSoyKjIpYCA9IGByIHJvdW5kKHNxcnQoMl4yKzJeMi0yKjAuOSoyKjIpLCAyKWAuDQpUaHVzLCBpZiB0aGUgY29ycmVsYXRpb24gaW5jcmVhc2VzIHRoZSBzdGFuZGFyZC1kZXZpYXRpb24gb2YgdGhlIGRpZmZlcmVuY2Utc2NvcmVzIGJlY29tZXMgc21hbGxlci4gDQpJZiB3ZSBkbyB0aGUgc2FtZSB3aXRoIGEgY29ycmVsYXRpb24gb2YgLjEwIHdlIGdldCBgc3FydCgyXjIrMl4yLTIqMC4xKjIqMilgID0gYHIgcm91bmQoc3FydCgyXjIrMl4yLTIqMC4xKjIqMiksIDIpYC4NClRodXMsIHdoZW4gdGhlIGNvcnJlbGF0aW9uIGRlY3JlYXNlcyB0aGUgc3RhbmRhcmQtZGV2aWF0aW9uIGJlY29tZXMgYmlnZ2VyLg0KSW50ZXJlc3RpbmdseSwgdGhpcyBkZW1vbnN0cmF0ZXMgdGhhdCBmb3IgdGhlIHNhbWUgbWVhbi1kaWZmZXJlbmNlLCBhIGhpZ2ggY29ycmVsYXRpb24gcmVzdWx0cyBpbiBhIF9sYXJnZXJfICRDb2hlbidzXCBkJCBhcyBjYWxjdWxhdGVkIGZvciB0aGUgZGlmZmVyZW5jZSBzY29yZXMgaW4gdGhlIG9uZS1zYW1wbGUgY2FzZS4NCkluIG90aGVyIHdvcmRzLCBhcyB0aGUgcHJlLXNjb3JlcyB0ZW5kIHRvIGJlIG1vcmUgc2ltaWxhciB0byB0aGUgcG9zdC1zY29yZXMgKGkuZS4gdGhleSBoYXZlIGEgaGlnaCBjb3JyZWxhdGlvbiksIHRoZSBzdGFuZGFyZC1kZXZpYXRpb24gb2YgdGhlIGRpZmZlcmVuY2Ugc2NvcmVzIGRlY3JlYXNlcy4NClRoaXMsIGluIHR1cm4sIHJlc3VsdHMgaW4gaGlnaGVyIHBvd2VyIHRvIGRldGVjdCBhbiBlZmZlY3QuDQoNCg0KVG8gc3VtIHVwIGFsbCBvZiB0aGUgYWJvdmUsIHdlIGNhbiBlaXRoZXIgc3BlY2lmeSBhIGRpZmZlcmVuY2Utc2NvcmUgZGlzdHJpYnV0aW9uIGRpcmVjdGx5IGFuZCB0aGVyZWJ5IGltcGx5IGEgY2VydGFpbiBjb3JyZWxhdGlvbiBieSBzcGVjaWZ5aW5nIHRoZSAkU0Rfe2RpZmZ9JCwgb3Igd2UgY2FuIHNlZSB3aGF0ICRTRF97ZGlmZn0kIHdlIGdldCB3aXRoIGEgY2VydGFpbiBjb3JyZWxhdGlvbiBieSB1c2luZyB0aGUgZm9ybXVsYSBhYm92ZSBhbmQgdXNlIHRoZSByZXN1bHQgZm9yIHRoZSBvbmUtc2FtcGxlIHNpbXVsYXRpb24uDQpIb3dldmVyLCBpbnN0ZWFkIG9mIHdvcmtpbmcgd2l0aCB0aGUgb25lLXNhbXBsZSB0LXRlc3QsIGluIHRoZSBuZXh0IHNlY3Rpb24sIHdlIHdpbGwgc2VlIGhvdyB3ZSBjYW4gZGlyZWN0bHkgc2ltdWxhdGUgY29ycmVsYXRlZCBub3JtYWwtZGlzdHJpYnV0aW9ucyBpbiBgUmAuDQoNCg0KIyMjIyBTaW11bGF0aW5nIGNvcnJlbGF0ZWQgbm9ybWFsLWRpc3RyaWJ1dGlvbnMgYW5kIGRlbXlzdGlmeWluZyB0aGUgbXVsdGl2YXJpYXRlIG5vcm1hbC4NCg0KSW4gcmVhbCBsaWZlLCBhbG1vc3QgZXZlcnl0aGluZyBpcyBjb3JyZWxhdGVkIHRvIHNvbWUgZGVncmVlLiANClRob3VnaCB0aGVzZSBjb3JyZWxhdGlvbnMgYXJlIG9mdGVuIG5vdCBvZiBpbnRlcmVzdCwgdGhleSBzb21ldGltZXMgYXJlIGFuZCBpbiBhIGdvb2Qgc2ltdWxhdGlvbiB3ZSB3YW50IHRvIGFja25vd2xlZGdlIHRoZW0uIEZvciBpbnN0YW5jZSwgcHJlZGljdG9ycyBpbiBhIHJlZ3Jlc3Npb24gbWlnaHQgYmUgY29ycmVsYXRlZCBvciByYW5kb20gZWZmZWN0cyBpbiBhIG1peGVkLW1vZGVsLg0KDQpUaGUgZm9sbG93aW5nIHBhcnQgaXMgKGFnYWluKSBsb25nZXIgdGhhbiBJIGludGVuZGVkIGJ1dCBJIGZlZWwgdGhhdCBpdCBpcyBpbXBvcnRhbnQgdG8gdW5kZXJzdGFuZCBob3cgd2Ugc2ltdWxhdGUgY29ycmVsYXRlZCBub3JtYWwtZGlzdHJpYnV0aW9ucyBhbmQgd2hhdCBhIG11bHRpdmFyaWF0ZSBub3JtYWwtZGlzdHJpYnV0aW9uIGlzLiANCkluIG1vc3QgY2FzZXMgbGF0ZXIgb24gd2Ugd2lsbCBkZWFsIHdpdGggc29tZSBraW5kIG9mIGNvcnJlbGF0ZWQgbm9ybWFsIGRpc3RyaWJ1dGlvbnMgKGluIG1peGVkLW1vZGVscyB3ZSB3aWxsIGFsd2F5cyBlbmNvdW50ZXIgdGhlbSBmb3IgZXhhbXBsZSkgc28gSSB0aGluayBpdCBoZWxwcyBpZiB3ZSBoYXZlIGEgbG9vayBhdCB0aGVtIG5vdyBpbiBhbiBlYXNpZXIgZXhhbXBsZSwgc28gd2UgaGF2ZSBvbmUgcHJvYmxlbSBsZXNzIHRvIHdvcnJ5IGFib3V0IGxhdGVyIG9uLg0KDQpSZXBocmFzaW5nIHRoZSBwcm9ibGVtIG9mIHNpbXVsYXRpbmcgdHdvIGNvcnJlbGF0ZWQgbm9ybWFsLWRpc3RyaWJ1dGlvbnMsIHdlIGNhbiBzYXkgdGhhdCB3ZSB3YW50IHRvIHNpbXVsYXRlIGEgX211bHRpdmFyaWF0ZSBub3JtYWwgZGlzdHJpYnV0aW9uXyBvciwgbW9yZSBzcGVjaWZpY2FsbHkgaW4gdGhpcyBjYXNlLCBhIF9iaXZhcmlhdGUgbm9ybWFsIGRpc3RyaWJ1dGlvbl8uIA0KSWYgeW91IG5ldmVyIGhlYXJkIHRoZXNlIHRlcm1zIGJlZm9yZSwgdGhleSBtaWdodCBzZWVtIHZlcnkgb3BhZ3VlLCBzbyBsZXQncyBzZWUgd2hhdCB0aGV5IGFyZS4NCkkgd2lsbCBmaXJzdCBzaG93IGhvdyB3ZSBjYW4gc2ltdWxhdGUgdGhlbSwgYW5kIGV4cGxhaW4gd2hhdCBleGFjdGx5IHRoaXMgbXVsdGl2YXJpYXRlIG5vcm1hbCBkaXN0cmlidXRpb24gbWVhbnMgYWZ0ZXJ3YXJkcyB3aXRoIGEgbGl0dGxlIHZpc3VhbCBpbnR1aXRvbi4NCldlIGNhbiBzaW11bGF0ZSBhIG11bHRpdmFyaWF0ZSBub3JtYWwgZGlzdHJpYnV0aW9uIGJ5IHVzaW5nIHRoZSBgbXZybm9ybSgpYCBmdW5jdGlvbiBmcm9tIHRoZSBgTUFTU2AgcGFja2FnZSBidXQgaXQgd29ya3Mgc2xpZ2h0bHkgZGlmZmVyZW50IHRoYW4gdGhlIHNpbXVsYXRpb24gZnVuY3Rpb25zIHRoYXQgd2UgaGF2ZSB1c2VkIHNvIGZhciAoYHJub3JtYCBhbmQgYHJiaW5vbWApLg0KTGV0cyBoYXZlIGEgbG9vayBhdCBob3cgdGhpcyB3b3JrcyAoY29kZSBleHBsYWluZWQgYmVsb3cpLg0KDQpgYGB7ciBzaW1fYml2bm9ybX0NCnJlcXVpcmUoTUFTUykgIyBsb2FkIE1BU1MgcGFja2FnZQ0KDQpwcmVfcG9zdF9tZWFucyA8LSBjKHByZSA9IDAscG9zdCA9IDEpICMgZGVmaW5lIG1lYW5zIG9mIHByZSBhbmQgcG9zdCBpbiBhIHZlY3Rvcg0KcHJlX3NkIDwtIDIgIyBkZWZpbmUgc2Qgb2YgcHJlLW1lYXN1cmUNCnBvc3Rfc2QgPC0gMiAjIGRlZmluZSBzZCBvZiBwb3N0LW1lYXN1cmUNCmNvcnJlbGF0aW9uIDwtIDAuNSAjIGRlZmluZSB0aGVpciBjb3JyZWxhdGlvbg0KDQpzaWdtYSA8LSBtYXRyaXgoYyhwcmVfc2ReMiwgcHJlX3NkKnBvc3Rfc2QqY29ycmVsYXRpb24sIHByZV9zZCpwb3N0X3NkKmNvcnJlbGF0aW9uLCBwb3N0X3NkXjIpLCBuY29sID0gMikgIyBkZWZpbmUgdmFyaWFuY2UtY292YXJpYW5jZSBtYXRyaXgNCg0Kc2V0LnNlZWQoMSkNCmJpdm5vcm0gPC0gZGF0YS5mcmFtZShtdnJub3JtKDEwMDAwLCBwcmVfcG9zdF9tZWFucywgc2lnbWEpKSAjIHNpbXVsYXRlIGJpdmFyaWF0ZSBub3JtYWwNCg0KYGBgDQoNClRoZSBhYm92ZSBjb2RlIHNhbXBsZXMgMTAsMDAwIG9ic2VydmF0aW9ucyBmcm9tIGEgYml2YXJpYXRlIG5vcm1hbC1kaXN0cmlidXRpb24sIG9yIGluIHRlcm1zIG9mIG91ciBleGFtcGxlLCBpdCBzYW1wbGVzIDEwLDAwMCBwcmUtbWVhc3VyZXMgd2l0aCAxMCwwMDAgY29ycmVsYXRlZCBwb3N0LW1lYXN1cmVzLg0KVGhlIGZpcnN0IHRoaW5nIHRoYXQgaXMgZGlmZmVyZW50IGZyb20gb3VyIGVhcmxpZXIgc2ltdWxhdGlvbnMgaXMgdGhlIGZpcnN0IGxpbmUgb2YgdGhlIGNvZGUgYHByZV9wb3N0X21lYW5zIDwtIGMoMCwxKWAuIA0KSW5zdGVhZCBvZiBkZWZpbmluZyBvdXIgbWVhbnMgc2VwZXJhdGVseSBmb3IgZWFjaCBtZWFzdXJlbWVudCwgYXMgd2UgaGF2ZSBkb25lIGVhcmxpZXIgaW4gdGhlIGluZGVwZW5kZW50LXNhbXBsZSBjYXNlLCB3ZSBub3cgcHV0IHRoZSBwcmUtIGFuZCBwb3N0LW1lYXN1cmVtZW50IG1lYW4gdGhhdCB3ZSBhc3N1bWUgaW50byBhIHZlY3Rvci4NClRoaXMgaXMgYmVjYXVzZSB3ZSB3aWxsIHNpbXVsYXRlIGJvdGggbWVhc3VyZW1lbnRzIHRvZ2V0aGVyIGluIHRoZSBgbXZybm9ybWAgZnVuY3Rpb24sIGFuZCB0aGVyZWZvcmUgYm90aCBtZWFucyBuZWVkIHRvIGJlIHByb3ZpZGVkIGF0IHRoZSBzYW1lIHRpbWUuDQoNClNlY29uZGx5LCB3ZSBkZWZpbmUgdGhlIHN0YW5kYXJkLWRldmlhdGlvbnMgb2YgYm90aCBtZWFzdXJlbWVudHMganVzdCBhcyB3ZSBkaWQgZWFybGllciBhbmQgYWxzbyBzcGVjaWZ5IGEgY29ycmVsYXRpb24gdGhhdCB3ZSB3b3VsZCBsaWtlIG91ciBkYXRhLXBvaW50cyB0byBoYXZlLCBpbiB0aGlzIGNhc2UgMC41Lg0KDQpOb3csIHRoZSBsaW5lIGBtYXRyaXgoYyhwcmVfc2ReMiwgcHJlX3NkKnBvc3Rfc2QqY29ycmVsYXRpb24sIHByZV9zZCpwb3N0X3NkKmNvcnJlbGF0aW9uLCBwb3N0X3NkXjIpLCBuY29sID0gMilgIGRvZXMgc29tZXRoaW5nIHRoYXQgd2UgaGF2ZSBub3QgZG9uZSBiZWZvcmUgYW5kIGl0IG1pZ2h0IGxvb2sgcXVpdGUgY29uZnVzaW5nLg0KV2hhdCB3ZSBhcmUgZG9pbmcgaGVyZSBpcyBzcGVjaWZ5aW5nIHRoZSBfdmFyaWFuY2UtY292YXJpYW5jZSBtYXRyaXhfLiANClRoaXMgaXMgbm90aGluZyBtb3JlIHRoYW4gYSB0YWJsZSBjb250YWluaW5nIHRoZSB2YXJpYW5jZXMgb2Ygb3VyIHByZS0gYW5kIHBvc3QtbWVhc3VyZW1lbnQgKHRoZSBmaXJzdCBhbmQgdGhlIGxhc3QgZW50cnkgaW4gdGhlIGxpc3QpIGFuZCB0aGUgY292YXJpYW5jZSBiZXR3ZWVuIHRoZSB0d28gdmFyaWFibGVzIHR3aWNlIC0gb25jZSBmb3IgZWFjaCBtZWFzdXJlbWVudCAodGhlIG1pZGRsZSAyIGVudHJpZXMgaW4gdGhlIGxpc3QpLg0KQ29uY2VwdHVhbGx5IHlvdSBjYW4gc2VlIHRoaXMgdmFyaWFuY2UtY292YXJpYW5jZSBtYXRyaXggYXMgdGhlIHN0YW5kYXJkLWRldmlhdGlvbiBvZiB0aGUgbXVsdGl2YXJpYXRlIG5vcm1hbCB0aGF0IGBtdnJub3JtYCBuZWVkcyBpbnN0ZWFkIG9mIHRoZSBzdGFuZGFyZC1kZXZpYXRpb24gdGhhdCB3ZSBwdXQgaW50byBgcm5vcm1gIGVhcmxpZXIuDQoNCldlIGNhbiB2aXN1YWxpemUgdGhlIHZhcmlhbmNlLWNvdmFyaWFuY2UgbWF0cml4IGBzaWdtYWAgdG8gZGVteXN0aWZ5IGl0IGEgYml0Lg0KDQpgYGB7ciB0YWJsZV9zaWdtYX0NCmNvbG5hbWVzKHNpZ21hKSA8LSBjKCJwcmUiLCAicG9zdCIpDQpyb3duYW1lcyhzaWdtYSkgPC0gYygicHJlIiwgInBvc3QiKQ0Kc2lnbWENCmBgYA0KDQpUaHVzLCB0aGlzIG1hdHJpeCBpcyBub3RoaW5nIG1vcmUgdGhhbiBhIHRhYmxlIGNvbnRhaW5pbmcgdGhlIHZhcmlhbmNlIG9mIGVhY2ggdmFyaWFibGUgKDQgaW4gZWFjaCBjYXNlKSBhbmQgdGhlaXIgY292YXJpYW5jZSAoaS5lLiB0aGUgY29ycmVsYXRpb24gb2YgdGhlIHR3byBtdWx0aXBsaWVkIGJ5IGJvdGggc3RhbmRhcmQtZGV2aWF0aW9ucyAoJENvdihwcmUscG9zdCkgPSBccmhvKHByZSxwb3N0KSpzZF97cHJlfSpzZF97cG9zdH0kKS4NCg0KSW4gdGhlIG5leHQgbGluZSBvZiB0aGUgY29kZSB3ZSBwdXQgdGhpcyBhbGwgaW50byBgbXZybm9ybWAgdG8gc2ltdWxhdGUgb3VyIGJpdmFyaWF0ZSBub3JtYWwgZGlzdHJpYnV0aW9uIGFuZCBzdG9yZSB0aGUgcmVzdWx0cyBpbiBhIGRhdGEtZnJhbWUgd2l0aCAyIGNvbHVtbnMsIGVhY2ggY29udGFpbmluZyBvbmUgbWVhc3VyZW1lbnQgcG9pbnQ6DQoNCmBgYHtyIGJpdmFyX2RhdH0NCmhlYWQoYml2bm9ybSkNCmBgYA0KDQpXaGVuIHdlIHJ1biBgY29yKGJpdm5vcm0kcHJlLCBiaXZub3JtJHBvc3QpYCB3ZSBzZWUgdGhhdCBpbmRlZWQgdGhlaXIgY29ycmVsYXRpb24gaXMgYHIgcm91bmQoY29yKGJpdm5vcm0kcHJlLCBiaXZub3JtJHBvc3QpLCAyKWAgYW5kIGNsb3NlIHRvIHdoYXQgd2Ugc3BlY2lmaWVkLg0KDQpUbyBzZWUgaG93IHdlIGNhbiBpbWFnaW5lIHN1Y2ggYSBiaXZhcmlhdGUgbm9ybWFsIGRpc3RyaWJ1dGlvbiwgd2UgY2FuIHZpc3VhbGl6ZSBpdCB0aGUgZm9sbG93aW5nIHdheS4NCg0KSWYgd2UgZHJhdyBhIGhpc3RvZ3JhbSBvZiBlYWNoIG1lYXN1cmVtZW50IGluZGl2aWR1YWxseSwgaXQgbG9va3MgbGlrZSB0aGlzLg0KDQpgYGB7ciBwbG90X2Jpdm5vcm0xfQ0KcGFyKG1mcm93PWMoMSwyKSkNCmhpc3QoYml2bm9ybSRwcmUsIG1haW4gPSAicHJlLW1lYXN1cmUiKQ0KaGlzdChiaXZub3JtJHBvc3QsIG1haW4gPSAicG9zdC1tZWFzdXJlIikNCmBgYA0KDQpIb3dldmVyLCBpbWFnaW5lIHdlIHdvdWxkIG5vdCBvbmx5IGxvb2sgYXQgZWFjaCBoaXN0b2dyYW0gc2VwZXJhdGVseSBidXQgd2Ugd291bGQgY29tYmluZSB0aGVtIGludG8gb25lIHBsb3QgYnkgcHV0dGluZyB0aGUgcHJlLW1lYXN1cmUgc2NvcmVzIG9mIGVhY2ggc2ltdWxhdGVkIGluZGl2aWR1YWwgb24gdGhlIHgtYXhpcyBhbmQgcHV0dGluZyB0aGUgcG9zdC1tZWFzdXJlcyBvbiB0aGUgeS1heGlzIGxpa2UgdGhpczoNCg0KYGBge3IgcGxvdF9iaXZub3JtMn0NCnBsb3QoYml2bm9ybSRwcmUsIGJpdm5vcm0kcG9zdCwgeGxhYiA9ICJwcmUtbWVhc3VyZSIsIHlsYWIgPSAicG9zdC1tZWFzdXJlIikNCmBgYA0KDQoNCkluIHRoZSBhYm92ZSBwbG90LCB3ZSBjYW4gY2xlYXJseSBzZWUgdGhlIGNvcnJlbGF0aW9ucyBiZXR3ZWVuIHRoZSB0d28gbWVhc3VyZW1lbnRzIHRoYXQgd2UgcHV0IGluIHRoZSBkYXRhLiANCk1vcmUgZWxlZ2FudGx5LCB3ZSBjYW4gY29tYmluZSB0aGUgdHdvIGhpc3RvZ3JhbXMgaW4gdGhlIGZvbGxvd2luZyB3YXkuDQoNCmBgYHtyIHBsb3RfYml2bm9ybTN9DQpiaXZub3JtX2tkZSA8LSBrZGUyZChiaXZub3JtWywxXSwgYml2bm9ybVssMl0sIG4gPSA1MCkgIyBjYWxjdWxhdGUga2VybmVsIGRlbnNpdHkgKGkuZS4gdGhlICJoZWlnaHQgb2YgdGhlIGNvbmUgb24gdGhlIHotYXhpcyI7IG5vdCBzbyBpbXBvcnRhbnQgdG8gdW5kZXJzdGFuZCBoZXJlKQ0KcGFyKG1hciA9IGMoMCwgMCwgMCwgMCkpICMgdGVsIHIgbm90IHRvIGxlYXZlIHNvIG11Y2ggc3BhY2UgYXJvdW5kIHRoZSBwbG90DQpwZXJzcChiaXZub3JtX2tkZSwgcGhpID0gNDUsIHRoZXRhID0gMzAsIHhsYWIgPSAicHJlLW1lYXN1cmUiLCB5bGFiID0gInBvc3QtbWVhc3VyZSIsIHpsYWIgPSAiZnJlcXVlbmN5IikgIyBwbG90IHRoZSBiaXZhcmlhdGUgbm9ybWFsDQpgYGANCg0KSGVyZSwgd2Ugc2VlIGNsZWFybHkgaG93IG91ciBiaXZhcmlhdGUgbm9ybWFsIGRpc3RyaWJ1dGlvbiBpcyBub3RoaW5nIG1vcmUgdGhhbiB0aGUgMiBub3JtYWwtZGlzdHJpYnV0aW9ucyBvZiBlYWNoIG1lYXN1cmVtZW50LXBvaW50IGNvbWJpbmVkIGludG8gb25lICJjb25lLXNoYXBlZCIgbm9ybWFsIGRpc3RyaWJ1dGlvbiB0aGF0IGhhcyBhIGNlcnRhaW4gY29ycmVsYXRpb24uDQoNClRoZSBwbG90IGJlbG93IHNob3dzIGhvdyB0aGlzIGNvbmUgbG9va3Mgd2l0aCBkaWZmZXJlbnQgY29ycmVsYXRpb25zLg0KDQoNCmBgYHtyIHBsb3RfYml2bm9ybV9jb3JzLCBlY2hvID0gRkFMU0UsIG91dC53aWR0aD0nMTIwJSd9DQpjb3IxMCA8LSAuMTANCnNpZ21hXzEwIDwtIG1hdHJpeChjKHByZV9zZF4yLCBwcmVfc2QqcG9zdF9zZCpjb3IxMCwgcHJlX3NkKnBvc3Rfc2QqY29yMTAsIHBvc3Rfc2ReMiksIG5jb2wgPSAyKQ0KYml2bm9ybV8xMCA8LSBtdnJub3JtKDFlNSwgcHJlX3Bvc3RfbWVhbnMsIHNpZ21hXzEwKQ0KYml2bm9ybTEwX2tkZSA8LSBrZGUyZChiaXZub3JtXzEwWywxXSwgYml2bm9ybV8xMFssMl0sIG4gPSA1MCkNCg0KDQpjb3I5MCA8LSAuOTANCnNpZ21hXzkwIDwtIG1hdHJpeChjKHByZV9zZF4yLCBwcmVfc2QqcG9zdF9zZCpjb3I5MCwgcHJlX3NkKnBvc3Rfc2QqY29yOTAsIHBvc3Rfc2ReMiksIG5jb2wgPSAyKQ0KYml2bm9ybV85MCA8LSBtdnJub3JtKDFlNSwgcHJlX3Bvc3RfbWVhbnMsIHNpZ21hXzkwKQ0KYml2bm9ybTkwX2tkZSA8LSBrZGUyZChiaXZub3JtXzkwWywxXSwgYml2bm9ybV85MFssMl0sIG4gPSA1MCkNCg0KcGFyKG1hciA9IGMoMSwgMCwgMSwgMCkpICMgdGVsbCByIG5vdCB0byBsZWF2ZSBzbyBtdWNoIHNwYWNlIGFyb3VuZCB0aGUgcGxvdA0KcGFyKG1mcm93PWMoMSwzKSkNCnBlcnNwKGJpdm5vcm0xMF9rZGUsIHBoaSA9IDQ1LCB0aGV0YSA9IDMwLCB4bGFiID0gInByZS1tZWFzdXJlIiwgeWxhYiA9ICJwb3N0LW1lYXN1cmUiLCB6bGFiID0gImZyZXF1ZW5jeSIsIG1haW4gPSAiY29ycmVsYXRpb24gPSAuMTAiKQ0KcGVyc3AoYml2bm9ybV9rZGUsIHBoaSA9IDQ1LCB0aGV0YSA9IDMwLCB4bGFiID0gInByZS1tZWFzdXJlIiwgeWxhYiA9ICJwb3N0LW1lYXN1cmUiLCB6bGFiID0gImZyZXF1ZW5jeSIsIG1haW4gPSAiY29ycmVsYXRpb24gPSAuNTAiKQ0KcGVyc3AoYml2bm9ybTkwX2tkZSwgcGhpID0gNDUsIHRoZXRhID0gMzAsIHhsYWIgPSAicHJlLW1lYXN1cmUiLCB5bGFiID0gInBvc3QtbWVhc3VyZSIsIHpsYWIgPSAiZnJlcXVlbmN5IiwgbWFpbiA9ICJjb3JyZWxhdGlvbiA9IC45MCIpDQoNCmBgYA0KDQpOb3RpY2UgaG93IGZvciBoaWdoZXIgY29ycmVsYXRpb25zLCB0aGUgY29uZSBiZWNvbWVzIG1vcmUgYW5kIG1vcmUgbmFycm93IGFuZCBzdGFydHMgbG9va2luZyBsaWtlIGEgInNoYXJrLWZpbiIgd2l0aCBhIGNvcnJlbGF0aW9uIG9mIC45MC4NClRoaXMgIm5hcnJvd3JpbmciIG9mIHRoZSBjb25lIGlzIHRoZSB2aXN1YWxpemF0aW9uIG9mIHdoeSB0aGUgc3RhbmRhcmQtZGV2aWF0aW9ucyBvZiB0aGUgZGlmZmVyZW5jZSBzY29yZXMgZ2V0IG1vcmUgbmFycm93LiANCg0KSWYgd2UgdmlzdWFsaXplIHRoaXMgYXMgYSBwb2ludCBjbG91ZCBhZ2FpbiB0aGUgdGhyZWUgY29ycmVsYXRpb25zIGxvb2sgbGlrZSB0aGlzOg0KDQpgYGB7ciBjb3JyZWxhdGlvbl9wb2ludHBsb3RzfQ0KYml2bm9ybV8xMCA8LSBhcy5kYXRhLmZyYW1lKGJpdm5vcm1fMTApDQpiaXZub3JtXzkwIDwtIGFzLmRhdGEuZnJhbWUoYml2bm9ybV85MCkNCnBhcihtZnJvdyA9IGMoMSwzKSkNCnBsb3QoYml2bm9ybV8xMCRwcmUsIGJpdm5vcm1fMTAkcG9zdCkNCnBsb3QoYml2bm9ybSRwcmUsIGJpdm5vcm0kcG9zdCkNCnBsb3QoYml2bm9ybV85MCRwcmUsIGJpdm5vcm1fOTAkcG9zdCkNCmBgYA0KDQpUaGlzIGFnYWluLCBjbGVhcmx5IHNob3dzIHRoZSBtYW5pcHVsYXRpbm8gYmV0d2VlbiB0aGUgcHJlLSBhbmQgcG9zdCBtZWFzdXJlcy4NCg0KIyMjIyBQb3dlci1hbmFseXNpcyB3aXRoIHRoZSBtdWx0aXZhcmlhdGUgbm9ybWFsDQoNCk5vdyB0aGF0IHdlIGtub3cgd2hhdCB3ZSBhcmUgZG9pbmcgd2hlbiB1c2luZyBgbXZybm9ybWAgd2UgY2FuIGdvIGFoZWFkIGFuZCBkbyBhIHBvd2VyLXNpbXVsYXRpb24gZm9yIHRoZSBleGFtcGxlIGFib3ZlIHdpdGggYSBiaXZhcmlhdGUgbm9ybWFsLWRpc3RyaWJ1dGlvbi4NCkhvd2V2ZXIsIGFzIHdlIGFyZSBub3Qgc3VyZSBob3cgYmlnIG91ciBjb3JyZWxhdGlvbiBpcywgd2UgY2FuIHRyeSAzIGRpZmZlcmVudCBjb3JyZWxhdGlvbnMgaW4gdGhlIGNvZGUgYWJvdmUgYnkgcGxhY2luZyB0aGUgc2ltdWxhdGlvbiBpbiBhbm90aGVyIGZvci1sb29wIGFuZCB0ZWxsaW5nIGl0IHRvIHRyeSBkaWZmZXJlbnQgY29ycmVsYXRpb25zLg0KDQpgYGB7ciBsYWJlbCwgb3B0aW9uc30NCm11X3ByZV9wb3N0IDwtIGMocHJlID0gMCwgcG9zdCA9IDEpDQpzZF9wcmUgPC0gMg0Kc2RfcG9zdCA8LSAyDQpjb3JyZWxhdGlvbnMgPC0gYygwLjEsIDAuNSwgMC45KQ0KDQpzZXQuc2VlZCgxKQ0Kbl9zaW1zIDwtIDEwMDAgIyB3ZSB3YW50IDEwMDAgc2ltdWxhdGlvbnMNCnBfdmFscyA8LSBjKCkNCiMgdGhpcyB2ZWN0b3Igd2lsbCBjb250YWluIHRoZSBwb3dlciBmb3IgZWFjaCBzYW1wbGUtc2l6ZSAoaXQgbmVlZHMgdGhlIGluaXRpYWwgMCBmb3IgdGhlIHdoaWxlLWxvb3AgdG8gd29yaykNCmNvaGVuc19kcyA8LSBjKCkNCg0KcG93ZXJzX2F0X2NvciA8LSBsaXN0KCkNCmNvaGVuc19kc19hdF9jb3IgPC0gbGlzdCgpDQoNCmZvcihpY29yIGluIDE6bGVuZ3RoKGNvcnJlbGF0aW9ucykpeyAjIGRvIGEgcG93ZXItc2ltdWxhdGlvbiBmb3IgZWFjaCBzcGVjaWZpZWQgc2ltdWxhdGlvbg0KICBuIDwtIDIgIyBzYW1wbGUtc2l6ZSANCiAgaSA8LSAyICMgaW5kZXggb2YgdGhlIHdoaWxlIGxvb3AgZm9yIHNhdmluZyB0aGluZ3MgaW50byB0aGUgcmlnaHQgcGxhY2UgaW4gdGhlIGxpc3RzDQogIHBvd2VyX2F0X24gPC0gYygwKSANCiAgY29oZW5zX2RzX2F0X24gPC0gYygpIA0KICBzaWdtYSA8LSBtYXRyaXgoYyhzZF9wcmVeMiwgc2RfcHJlKnNkX3Bvc3QqY29ycmVsYXRpb25zW2ljb3JdLCBzZF9wcmUqc2RfcG9zdCpjb3JyZWxhdGlvbnNbaWNvcl0sIHNkX3Bvc3ReMiksIG5jb2wgPSAyKSAjdmFyLWNvdmFyIG1hdHJpeA0KICB3aGlsZShwb3dlcl9hdF9uW2ktMV0gPCAuOTUpew0KICAgIGZvcihzaW0gaW4gMTpuX3NpbXMpew0KICAgICAgYml2bm9ybSA8LSBkYXRhLmZyYW1lKG12cm5vcm0obiwgbXVfcHJlX3Bvc3QsIHNpZ21hKSkgIyBzaW11bGF0ZSB0aGUgYml2YXJpYXRlIG5vcm1hbA0KICAgICAgcF92YWxzW3NpbV0gPC0gdC50ZXN0KGJpdm5vcm0kcHJlLCBiaXZub3JtJHBvc3QsIHBhaXJlZCA9IFRSVUUsIHZhci5lcXVhbCA9IFRSVUUsIGNvbmYubGV2ZWwgPSAwLjkpJHAudmFsdWUgIyBydW4gdC10ZXN0IGFuZCBleHRyYWN0IHRoZSBwLXZhbHVlDQogICAgICBjb2hlbnNfZHNbc2ltXSA8LSBhYnMoKG1lYW4oYml2bm9ybSRwcmUpLW1lYW4oYml2bm9ybSRwb3N0KSkvKHNxcnQoc2QoYml2bm9ybSRwcmUpXjIrc2QoYml2bm9ybSRwb3N0KV4yLTIqY29yKGJpdm5vcm0kcHJlLCBiaXZub3JtJHBvc3QpKnNkKGJpdm5vcm0kcHJlKSpzZChiaXZub3JtJHBvc3QpKSkpICMgd2UgYWxzbyBzYXZlIHRoZSBjb2hlbnMgZHMgdGhhdCB3ZSBvYnNlcnZlZCBpbiBlYWNoIHNpbXVsYXRpb24NCiAgICB9DQogICAgcG93ZXJfYXRfbltpXSA8LSBtZWFuKHBfdmFscyA8IC4xMCkgIyBjaGVjayBwb3dlciAoaS5lLiBwcm9wb3J0aW9uIG9mIHAtdmFsdWVzIHRoYXQgYXJlIHNtYWxsZXIgdGhhbiBhbHBoYS1sZXZlbCBvZiAuMTApDQogICAgbmFtZXMocG93ZXJfYXRfbilbaV0gPC0gbg0KICAgIGNvaGVuc19kc19hdF9uW2ldIDwtIG1lYW4oY29oZW5zX2RzKSAjIGNhbGN1bGF0ZSBtZWFucyBvZiBjb2hlbnMgZHMgZm9yIGVhY2ggc2FtcGxlLXNpemUNCiAgICBuYW1lcyhjb2hlbnNfZHNfYXRfbilbaV0gPC0gbg0KICAgIG4gPC0gbisxICMgaW5jcmVhc2Ugc2FtcGxlLXNpemUgYnkgMQ0KICAgIGkgPC0gaSsxICMgaW5jcmVhc2UgaW5kZXggb2YgdGhlIHdoaWxlLWxvb3AgYnkgMSB0byBzYXZlIHBvd2VyIGFuZCBjb2hlbnMgZCB0byB2ZWN0b3INCiAgfQ0KICBwb3dlcl9hdF9uIDwtIHBvd2VyX2F0X25bLTFdICMgZGVsZXRlIGZpcnN0IDAgZnJvbSB0aGUgdmVjdG9yDQogIGNvaGVuc19kc19hdF9uIDwtIGNvaGVuc19kc19hdF9uWy0xXSAjIGRlbGV0ZSBmaXJzdCBOQSBmcm9tIHRoZSB2ZWN0b3INCiAgcG93ZXJzX2F0X2NvcltbaWNvcl1dIDwtIHBvd2VyX2F0X24gIyBzdG9yZSB0aGUgZW50aXJlIHBvd2VyIGN1cnZlIGZvciB0aGlzIGNvcnJlbGF0aW9uIGluIGEgbGlzdA0KICBjb2hlbnNfZHNfYXRfY29yW1tpY29yXV0gPC0gY29oZW5zX2RzX2F0X24gIyBkbyB0aGUgc2FtZSBmb3IgY29oZW5zIGQNCiAgbmFtZXMocG93ZXJzX2F0X2NvcilbW2ljb3JdXSA8LSBjb3JyZWxhdGlvbnNbaWNvcl0gIyBuYW1lIHRoZSBwb3dlci1jdXJ2ZSBpbiB0aGUgbGlzdCBhY2NvcmRpbmcgdG8gdGhlIHRlc3RlZCBjb3JyZWxhdGlvbg0KICBuYW1lcyhjb2hlbnNfZHNfYXRfY29yKVtbaWNvcl1dIDwtIGNvcnJlbGF0aW9uc1tpY29yXSAjIHNhbWUgZm9yIGNvaGVucyBkDQp9DQpgYGANCg0KDQpBZ2FpbiwgdGhlIGFib3ZlIGNvZGUgcnVucyBhIHBvd2VyLXNpbXVsYXRpb24sIG9yIG1vcmUgc3BlY2lmaWNhbGx5IHRocmVlIHBvd2VyLWFuYWx5c2VzLCBvbmUgZm9yIGVhY2ggY29ycmVsYXRpb24gdGhhdCB3ZSB3YW50ZWQgdG8gdGVzdC4NCk5vdGljZSBob3cgdGhpcyB0aW1lIHdlIHNwZWNpZnkgYHBhaXJlZCA9IFRSVUVgIGluIHRoZSBgdC50ZXN0YCBmdW5jdGlvbiwgdG8gaW5kaWNhdGUgdGhhdCB3ZSBhcmUgZGVhbGluZyB3aXRoIG5vbi1pbmRlcGVuZGVudCBvYnNlcnZhdGlvbnMuDQpBbHNvIG5vdGUgdGhhdCBhIG5ldyBwYXJ0IG9mIHRoZSBjb2RlIHNhdmVzIHRoZSBgcG93ZXJfYXRfbmAgdmVjdG9yIHRvIGEgbGlzdCBjYWxsZWQgYHBvd2VyX2F0X2NvcmAuIA0KVGhpcyBsaXN0LCB3aWxsIGhhdmUgMyBlbGVtZW50cywgZWFjaCBvZiB0aGVtIHRoZSBwb3dlciBjdXJ2ZSBmb3Igb25lIG9mIHRoZSBjb3JyZWxhdGlvbnMuDQpXZSBjYW4gYWNjZXNzIGVhY2ggcG93ZXItY3VydmUgYmVpIGVpdGhlciBgcG93ZXJzX2F0X2NvcltbMV1dYCB0byBnZXQgdGhlIGZpcnN0IHZlY3RvciBpbiB0aGUgbGlzdCAodGhlIGRvdWJsZSBzcXVhcmUgYnJhY2tldHMgbWVhbiBmaXJzdCBlbnRpcmUgdmVjdG9yIHJhdGhlciB0aGFuIGZpcnN0IG51bWJlciBvbmx5KSBvciB3ZSBjYW4gdXNlIGl0IGJ5IGluZGljYXRpbmcgaXRzIG5hbWUgYXMgYHBvd2Vyc19hdF9jb3IkYDAuMWAgdG8gdGVsbCBSIHRoYXQgd2Ugd2FudCB0aGUgcG93ZXIgY3VydmUgZm9yIGEgY29ycmVsYXRpb24gb2YgLjEwLg0KDQpXZSBjYW4gcGxvdCB0aGVzZSBwb3dlci1jdXJ2ZXMgbmV4dCB0byBlYWNoIG90aGVyDQoNCmBgYHtyIHBvd2VyY3VydmVfY29ycl90LXRlc3QsIG91dC53aWR0aD0nMTIwJSd9DQpwYXIobWZyb3c9YygxLDMpKQ0KcGxvdCgyOihsZW5ndGgocG93ZXJzX2F0X2NvciRgMC4xYCkrMSksIHBvd2Vyc19hdF9jb3IkYDAuMWAsIHhsYWIgPSAiTnVtYmVyIG9mIHBhcnRpY2lwYW50cyIsIHlsYWIgPSAiUG93ZXIiLCB5bGltID0gYygwLDEpLCBheGVzID0gVFJVRSwgbWFpbiA9ICJjb3JyZWxhdGlvbiA9IDAuMSIpDQphYmxpbmUoaCA9IC45NSwgY29sID0gInJlZCIpDQpwbG90KDI6KGxlbmd0aChwb3dlcnNfYXRfY29yJGAwLjVgKSsxKSwgcG93ZXJzX2F0X2NvciRgMC41YCwgeGxhYiA9ICJOdW1iZXIgb2YgcGFydGljaXBhbnRzIiwgeWxhYiA9ICJQb3dlciIsIHlsaW0gPSBjKDAsMSksIGF4ZXMgPSBUUlVFLCBtYWluID0gImNvcnJlbGF0aW9uID0gMC41IikNCmFibGluZShoID0gLjk1LCBjb2wgPSAicmVkIikNCnBsb3QoMjoobGVuZ3RoKHBvd2Vyc19hdF9jb3IkYDAuOWApKzEpLCBwb3dlcnNfYXRfY29yJGAwLjlgLCB4bGFiID0gIk51bWJlciBvZiBwYXJ0aWNpcGFudHMiLCB5bGFiID0gIlBvd2VyIiwgeWxpbSA9IGMoMCwxKSwgYXhlcyA9IFRSVUUsIG1haW4gPSAiY29ycmVsYXRpb24gPSAwLjkiKQ0KYWJsaW5lKGggPSAuOTUsIGNvbCA9ICJyZWQiKQ0KYGBgDQoNCkhlcmUgd2Ugc2VlIGhvdyBkcmFzdGljYWxseSB0aGUgY29ycmVsYXRpb24gaW5mbHVlbmNlcyB0aGUgcG93ZXIgaW4gdGhpcyBzaXR1YXRpb24uDQpXaXRoIGEgaGlnaCBjb3JyZWxhdGlvbiwgd2UgbmVlZCBvbmx5IHZlcnkgZmV3IHBhcnRpY2lwYW50cyB0byBhY2hpZXZlIHRoZSBkZXNpcmVkIHBvd2VyIGluIHRoZSBzcGVjaWZpZWQgY2FzZS4NCldoeSBpcyB0aGlzPyANClRoZSByZWFzb24gZm9yIHRoaXMgaXMgd2hhdCB3ZSBoYWQgYSBsb29rIGF0IGFib3ZlOiBUaGUgZGVjcmVhc2luZyBzdGFuZGFyZC1kZXZpYXRpb24gb2YgdGhlIGRpZmZlcmVuY2Ugc2NvcmVzIHRoZSBoaWdoZXIgdGhlIGNvcnJlbGF0aW9uIGdldHMuIA0KDQpUaGlzIGlzIGhvdyB0aGUgZWZmZWN0LXNpemVzIGxvb2suDQoNCmBgYHtyIGNvaGVuc19kX2NvcnJfdHRlc3QsIG91dC53aWR0aD0nMTIwJSd9DQpwYXIobWZyb3c9YygxLDMpKQ0KcGxvdCgyOihsZW5ndGgoY29oZW5zX2RzX2F0X2NvciRgMC4xYCkrMSksIGNvaGVuc19kc19hdF9jb3IkYDAuMWAsIHhsYWIgPSAiTnVtYmVyIG9mIHBhcnRpY2lwYW50cyIsIHlsYWIgPSAiQ29oZW5zIEQiLCB5bGltID0gYygwLDEpLCBheGVzID0gVFJVRSwgbWFpbiA9ICJjb3JyZWxhdGlvbiA9IDAuMSIpDQphYmxpbmUoaCA9IC41MCwgY29sID0gInJlZCIpDQpwbG90KDI6KGxlbmd0aChjb2hlbnNfZHNfYXRfY29yJGAwLjVgKSsxKSwgY29oZW5zX2RzX2F0X2NvciRgMC41YCwgeGxhYiA9ICJOdW1iZXIgb2YgcGFydGljaXBhbnRzIiwgeWxhYiA9ICJDb2hlbnMgRCIsIHlsaW0gPSBjKDAsMSksIGF4ZXMgPSBUUlVFLCBtYWluID0gImNvcnJlbGF0aW9uID0gMC41IikNCmFibGluZShoID0gLjUwLCBjb2wgPSAicmVkIikNCnBsb3QoMjoobGVuZ3RoKGNvaGVuc19kc19hdF9jb3IkYDAuOWApKzEpLCBjb2hlbnNfZHNfYXRfY29yJGAwLjlgLCB4bGFiID0gIk51bWJlciBvZiBwYXJ0aWNpcGFudHMiLCB5bGFiID0gIkNvaGVucyBEIiwgeWxpbSA9IGMoMCwxMCksIGF4ZXMgPSBUUlVFLCBtYWluID0gImNvcnJlbGF0aW9uID0gMC45IikNCmFibGluZShoID0gLjUwLCBjb2wgPSAicmVkIikNCmBgYA0KDQpGb3IgLjEwIHRoZSB2YWx1ZSBvZiB0aGUgZWZmZWN0LXNpemUgc2VlbXMgc2xpZ2h0bHkgdW5kZXJlc3RpbWF0ZWQsIGZvciAuNTAgaXQgYXBwcm9hY2hlcyAuNTAganVzdCBhcyBpbiB0aGUgdHdvLXNhbXBsZSBjYXNlIGFuZCBmb3IgLjkwIGl0IHNlZW1zIG92ZXJlc3RpbWF0ZWQgYnkgcXVpdGUgYSBiaXQuIA0KRGlkIHNvbWV0aGluZyBnbyB3cm9uZz8NCldlbGwgbm8uIEFzIHdlJ3ZlIHNlZW4gYWJvdmUgJENvaGVuJ3NcIGQkIGlzIGNhbGN1bGF0ZWQgYnkgZGl2aWRpbmcgdGhlIG1lYW4tZGlmZmVyZW5jZSBieSB0aGUgc3RhbmRhcmQtZGV2aWF0aW9uIG9mIHRoZSBkaWZmZXJlbmNlIHNjb3JlcyB3aGljaCBiZWNvbWVzIHNtYWxsZXIgYW5kIHNtYWxsZXIgd2l0aCBpbmNyZWFzaW5nIGNvcnJlbGF0aW9uLg0KVGhlcmVmb3JlLCBjYWxjdWxhdGVkIHRoaXMgd2F5LCAkQ29oZW4nc1wgZCQgaXMgbXVjaCBiaWdnZXIgaW4gdGhlIGNhc2Ugd2l0aCB0aGUgbGFyZ2VyIGNvcnJlbGF0aW9uLg0KVGhpcyBpcyBhbHNvIHdoeSB3ZSBzZWVtIHRvIGhhdmUgbXVjaCBiaWdnZXIgcG93ZXIgLSB3ZSBqdXN0IHdvcmsgd2l0aCBhIGxhcmdlciBlZmZlY3Qgc2l6ZSB0aGFuIHdlIGludGVuZGVkLg0KV2UgY2FuIGV2ZW4gY2FsY3VsYXRlIGJ5IGhvdyBtdWNoIHRoZSBlZmZlY3Qtc2l6ZSBpcyBpbmZsdWVuY2VkIGJ5IHRoZSBjb3JyZWxhdGlvbiBieSBkaXZpZGluZyB0aGUgZWZmZWN0LXNpemUgdGhhdCB3ZSB3b3VsZCBjYWxjdWxhdGUgYmFzZWQgb24gdGhlIG1lYW5zIGFuZCBzZHMgb2Ygb3VyIGdyb3VwcyBieSAkXHNxcnR7MigxLXIpfSQuIA0KDQpyID0gLjkwIC0tPiBgMC41L3NxcnQoMiooMS0uOTApKWAgPSBgciAwLjUvc3FydCgyKigxLS45MCkpYA0KciA9IC41MCAtLT4gYDAuNS9zcXJ0KDIqKDEtLjUwKSlgID0gYHIgMC41L3NxcnQoMiooMS0uNTApKWANCnIgPSAuMTAgLS0+IGAwLjUvc3FydCgyKigxLS4xMCkpYCA9IGByIDAuNS9zcXJ0KDIqKDEtLjEwKSlgDQoNCllvdSBtaWdodCB3b25kZXIgaG93IHdlIGNhbiBzcGVjaWZ5IGVmZmVjdC1zaXplcyBpbiB0aGVzZSBjYXNlcyBvZiBjb3JyZWxhdGVkIGRhdGEuIERvIHdlICJjb3JyZWN0IiB0aGUgZXhwZWN0ZWQgZWZmZWN0IGZvciB0aGUgY29ycmVsYXRpb24gb3IgZG8gd2UganVzdCBhc3N1bWUgdGhhdCBpdCBpcyAuNTAgYW5kIHVzZSB0aGUgb25lLXNhbXBsZSBzY2VuYXJpbyBhYm92ZT8gDQpJIGRvIG5vdCBoYXZlIGEgZ29vZCBhbnN3ZXIgZm9yIHRoaXMuIA0KSW4gbWFueSBjYXNlcyBpdCBtaWdodCBiZSBmaW5lIHRvIG9ubHkgc3BlY2lmeSB0aGUgZWZmZWN0LXNpemUgb2YgdGhlIHByZS1wb3N0IGRlc2lnbiBiYXNlZCBvbiB0aGUgZGlmZmVyZW5jZSBzY29yZXMgYXMgd2UgZGlkIGluIHRoZSBvbmUtc2FtcGxlIGNhc2UuDQpJbiBzb21lIGNhc2VzLCBob3dldmVyLCB3ZSBtaWdodCBmaW5kIHRoZSBjb3JyZWxhdGlvbiB2ZXJ5IGltcG9ydGFudCBvciBoYXZlIG1vcmUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGNvcnJlbGF0aW9uIG9mIDIgbWVhc3VyZXMgdGhhbiBhYm91dCB0aGUgY2hhbmdlIGluIG1lYXN1cmVzIGR1ZSB0byBhbiBpbnRlcnZlbnRpb24uIA0KSW4gdGhvc2UgY2FzZXMsIGl0IG1pZ2h0IG1ha2Ugc2Vuc2UgdG8gYmUgdmVyeSBzcGVjaWZpYyBhYm91dCB0aGUgZXhwZWN0ZWQgY29ycmVsYXRpb25zIGFuZCBiZSBhd2FyZSB0aGF0IHdlIG1pZ2h0IG5lZWQgbW9yZSBkYXRhIGlmIHRoZSBjb3JyZWxhdGlvbiBpcyBsb3cuDQpFdmVudHVhbGx5LCBvdXIgZGF0YSBzdGVtIGZyb20gYW4gdW5kZXJseWluZyBfZGF0YSBnZW5lcmF0aW5nIHByb2Nlc3NfIHRoYXQgaW5jbHVkZXMgdGhlIGNvcnJlbGF0aW9uIGJldHdlZW4gdmFyaWFibGVzIGFuZCBtZWFzdXJlcyBhbmQgaXQgaXMgYWx3YXlzIGdvb2QgdG8gYmUgYXdhcmUgb2YgdGhlIGZhY3RvcnMgdGhhdCBtaWdodCBwb3NzaWJseSBpbmZsdWVuY2UgdGhlIHJlc3VsdHMuIA0KV2hlbiB3ZSBjb2xsZWN0IGRhdGEgaW4gYSBwcmUtcG9zdCBkZXNpZ24sIHdlIF9kb18gaW4gZmFjdCBtZWFzdXJlIGEgc2NvcmUgYXQgMiB0aW1lLXBvaW50cyBhbmQgZG8gbm90IGRpcmVjdGx5IGFzc2VzcyB0aGUgZGlmZmVyZW5jZS4gDQpXaGVuIHdlIHNwZWNpZnkgdGhlIHN0YW5kYXJkLWRldmlhdGlvbiBvZiB0aGUgZGlmZmVyZW5jZSBzY29yZXMgaG93ZXZlciwgdG8gYXJyaXZlIGF0IGEgZ2l2ZW4gJENvaGVuJ3NcIGQkLCB3ZSBpbXBsaWNpdGVseSBtYWtlIGFzc3VtcHRpb25zIGFib3V0IHRoZSBjb3JyZWxhdGlvbnMgb2YgdGhlc2UgdHdvIG1lYXN1cmVzLg0KDQpUaGUgVGFrZS1ob21lIG1lc3NhZ2UgaGVyZSBpcyB0aGF0IGNvcnJlbGF0aW9ucyBtYXR0ZXIgYW5kIHRoYXQgd2UgbmVlZCB0byBiZSBhd2FyZSBvZiB0aGlzLiBUaGUgZ29vZCBuZXdzIGlzIHRoYXQgcG93ZXItc2ltdWxhdGlvbnMgd2lsbCBhdCBsZWFzdCBtYWtlIHVzIGF3YXJlIG9mIHRoZXNlIGZhY3RvcnMgYW5kIHNob3cgdXMgaG93IGRpZmZlcmVudCBhc3N1bXB0aW9ucyBsZWFkIHRvIGRpZmZlcmVudCByZXN1bHRzLiANCg0KDQojIyBTdW1tYXJ5OiBPdXIgZmlyc3Qgc2ltdWxhdGlvbnMgd2l0aCB0LXRlc3RzDQoNClRoaXMgd2FzIHRoZSBsYXN0IGJpdCB0aGF0IEkgd2FudGVkIHRvIGRpc2N1c3MgYWJvdXQgc2ltdWxhdGluZyB0LXRlc3RzIGFuZCB0aGUgZW5kIG9mIHBhcnQgSUkgb2YgdGhpcyB0dXRvcmlhbC4NCldlIGhhdmUgbm93IGxlYXJuZWQgaG93IHRvIHNpbXVsYXRlIGEgdC10ZXN0IGJ5IHVzaW5nIGVpdGhlciAkQ29oZW4nc1wgZCQgYXMgYW4gZWZmZWN0LXNpemUgZXN0aW1hdGUgYW5kLCBpZiBuZWNlc3NhcnksIHRlbGwgYFJgIHRoYXQgb3VyIHR3byBncm91cHMsIG9yIG1lYXN1cmVtZW50cywgYXJlIGNvcnJlbGF0ZWQgaW4gc29tZSB3YXkuDQpXaGF0IHdlIGxlYXJuZWQgYWJvdmUgaXMgbm90IHJlc3RyaWN0ZWQgdG8gZG9pbmcgdC10ZXN0cyBob3dldmVyLg0KU2ltdWxhdGluZyB1bml2YXJpYXRlIChpLmUuIHVuY29ycmVsYXRlZCkgb3IgbXVsdGl2YXJpYXRlIChpLmUuIGNvcnJlbGF0ZWQpIG5vcm1hbC1kaXN0cmlidXRpb25zIHdpbGwgYmUgd2hhdCB3ZSBkbyBtb3N0IG9mIHRoZSB0aW1lIGluIHBhcnQgSUlJIGFuZCBwYXJ0IElWIG9mIHRoZSB0dXRvcmlhbC4NClRoZSBvbmx5IHRoaW5nIHRoYXQgd2lsbCBjaGFuZ2UgZm9yIG1vcmUgY29tcGxpY2F0ZWQgZGVzaWducyBpcyBob3cgd2UgY29tYmluZSB0aGUgZGlmZmVyZW50IHRvb2xzIHRoYXQgd2UgbGVhcm5lZCBpbiB0aGlzIHBhcnQgdG8gYWNoaWV2ZSBvdXIgZ29hbC4NCg0KSW4gcGFydCBJSUkgb2YgdGhpcyB0dXRvcmlhbCwgd2Ugd2lsbCBzZWUgaG93IHdlIGNhbiBiYXNpY2FsbHkgcnVuIGV2ZXJ5IGFuYWx5c2lzIGFzIGEgbGluZWFyIG1vZGVsIHVzaW5nIHRoZSBgbG1gIGZ1bmN0aW9uIGluc3RlYWQgb2YgdXNpbmcgdGhlIGB0LnRlc3RgIGZ1bmN0aW9uIGZvciB0LXRlc3RzLCB0aGUgYGFvdmAgZnVuY3Rpb24gZm9yIEFOT1ZBLWRlc2lnbnMgYW5kIHNvIGZvcnRoLg0KQnkgZXhwbG9yaW5nIGhvdyB0aGlzIHdvcmtzIGZvciB0LXRlc3QsIGFub3ZhIGFuZCByZWdyZXNzaW9uIHdlIHdpbGwgc2ltdWxhdGUgb3VyIHdheSB0aHJvdWdoIHRoZSB0aGlyZCBwYXJ0IGFuZCBiZSBmbGV4aWJsZSBlbm91Z2ggdG8gc2ltdWxhdGUgYW55IGNsYXNzaWNhbCByZXNlYXJjaCBkZXNpZ25zIHRoYXQgd2Ugd291bGQsIGZvciBleGFtcGxlLCBiZSBhYmxlIHRvIGRvIGluIEdQb3dlci4gSW4gcGFydCBJViB3ZSB3aWxsIGdvIGJleW9uZCB0aGlzIGFuZCBzaW11bGF0ZSBtaXhlZC1lZmZlY3QgbW9kZWxzLg0KDQojIEZvb3Rub3Rlcw0KDQpbXjFdOg0KVGhpbmsgYmFjayB0byB0aGUgcG9zc2libGUgc2VxdWVuY2VzIG9mIGNvaW4gdG9zc2VzIGluIHBhcnQgSS4gDQpJbnN0ZWFkIG9mIHBvc3NpYmxlIHNlcXVlbmNlcyBvZiBjb2luLXRvc3Nlcywgd2UgZGVhbCB3aXRoIHBvc3NpYmxlIHNlcXVlbmNlcyBvZiBwZW9wbGUtc2NvcmVzIGhlcmUsIGFzc3VtaW5nIHRoYXQgdGhleSBjb21lIGZyb20gdGhlIHVuZGVybHlpbmcgZGlzdHJpYnV0aW9uIHRoYXQgd2Ugc3BlY2lmeS4NClRvIGdldCBhIGdvb2QgYXBwcm94aW1hdGlvbiBvZiBhbGwgdGhlIHBvc3NpYmxlIHNhbXBsZXMgdGhhdCB3ZSBjb3VsZCBnZXQgdGhhdCBzdGlsbCBmb2xsb3cgdGhlIHNwZWNpZmllZCBkaXN0cmlidXRpb24sIHdlIG5lZWQgdG8gc2ltdWxhdGUgbWFueSwgbWFueSB0aW1lcy4NCg0KW14yXTogDQpUaGlzIGlzIGhvdyB3ZSBzb2x2ZSBmb3Igcjo8bWF0aCB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OC9NYXRoL01hdGhNTCIgZGlzcGxheT0iYmxvY2siPg0KICA8bXRhYmxlIGRpc3BsYXlzdHlsZT0idHJ1ZSIgY29sdW1uYWxpZ249InJpZ2h0IGxlZnQgcmlnaHQgbGVmdCByaWdodCBsZWZ0IHJpZ2h0IGxlZnQgcmlnaHQgbGVmdCByaWdodCBsZWZ0IiBjb2x1bW5zcGFjaW5nPSIwZW0gMmVtIDBlbSAyZW0gMGVtIDJlbSAwZW0gMmVtIDBlbSAyZW0gMGVtIiByb3dzcGFjaW5nPSIzcHQiPg0KICAgIDxtdHI+DQogICAgICA8bXRkPjwvbXRkPg0KICAgICAgPG10ZD4NCiAgICAgICAgPG1uPjI8L21uPg0KICAgICAgICA8bW8+PTwvbW8+DQogICAgICAgIDxtc3FydD4NCiAgICAgICAgICA8bXN1cD4NCiAgICAgICAgICAgIDxtbj4yPC9tbj4NCiAgICAgICAgICAgIDxtbj4yPC9tbj4NCiAgICAgICAgICA8L21zdXA+DQogICAgICAgICAgPG1vPis8L21vPg0KICAgICAgICAgIDxtc3VwPg0KICAgICAgICAgICAgPG1uPjI8L21uPg0KICAgICAgICAgICAgPG1uPjI8L21uPg0KICAgICAgICAgIDwvbXN1cD4NCiAgICAgICAgICA8bW8+JiN4MjIxMjs8L21vPg0KICAgICAgICAgIDxtbj4yPC9tbj4NCiAgICAgICAgICA8bWk+cjwvbWk+DQogICAgICAgICAgPG1vPiYjeEQ3OzwvbW8+DQogICAgICAgICAgPG1uPjI8L21uPg0KICAgICAgICAgIDxtbz4mI3hENzs8L21vPg0KICAgICAgICAgIDxtbj4yPC9tbj4NCiAgICAgICAgPC9tc3FydD4NCiAgICAgIDwvbXRkPg0KICAgIDwvbXRyPg0KICAgIDxtdHI+DQogICAgICA8bXRkPg0KICAgICAgICA8bXN0eWxlIHNjcmlwdGxldmVsPSIwIj4NCiAgICAgICAgICA8bXNwYWNlIHdpZHRoPSJ0aGlja21hdGhzcGFjZSI+PC9tc3BhY2U+DQogICAgICAgIDwvbXN0eWxlPg0KICAgICAgICA8bW8gc3RyZXRjaHk9ImZhbHNlIj4mI3gyN0ZBOzwvbW8+DQogICAgICAgIDxtc3R5bGUgc2NyaXB0bGV2ZWw9IjAiPg0KICAgICAgICAgIDxtc3BhY2Ugd2lkdGg9InRoaWNrbWF0aHNwYWNlIj48L21zcGFjZT4NCiAgICAgICAgPC9tc3R5bGU+DQogICAgICA8L210ZD4NCiAgICAgIDxtdGQ+DQogICAgICAgIDxtbj4yPC9tbj4NCiAgICAgICAgPG1vPj08L21vPg0KICAgICAgICA8bXNxcnQ+DQogICAgICAgICAgPG1uPjg8L21uPg0KICAgICAgICAgIDxtbz4mI3gyMjEyOzwvbW8+DQogICAgICAgICAgPG1uPjg8L21uPg0KICAgICAgICAgIDxtaT5yPC9taT4NCiAgICAgICAgPC9tc3FydD4NCiAgICAgIDwvbXRkPg0KICAgICAgPG10ZD4NCiAgICAgICAgPG1pPjwvbWk+DQogICAgICAgIDxtc3VwPg0KICAgICAgICAgIDxtbyBzdHJldGNoeT0iZmFsc2UiPnw8L21vPg0KICAgICAgICAgIDxtbj4yPC9tbj4NCiAgICAgICAgPC9tc3VwPg0KICAgICAgPC9tdGQ+DQogICAgPC9tdHI+DQogICAgPG10cj4NCiAgICAgIDxtdGQ+DQogICAgICAgIDxtc3R5bGUgc2NyaXB0bGV2ZWw9IjAiPg0KICAgICAgICAgIDxtc3BhY2Ugd2lkdGg9InRoaWNrbWF0aHNwYWNlIj48L21zcGFjZT4NCiAgICAgICAgPC9tc3R5bGU+DQogICAgICAgIDxtbyBzdHJldGNoeT0iZmFsc2UiPiYjeDI3RkE7PC9tbz4NCiAgICAgICAgPG1zdHlsZSBzY3JpcHRsZXZlbD0iMCI+DQogICAgICAgICAgPG1zcGFjZSB3aWR0aD0idGhpY2ttYXRoc3BhY2UiPjwvbXNwYWNlPg0KICAgICAgICA8L21zdHlsZT4NCiAgICAgIDwvbXRkPg0KICAgICAgPG10ZD4NCiAgICAgICAgPG1uPjQ8L21uPg0KICAgICAgICA8bW8+PTwvbW8+DQogICAgICAgIDxtbj44PC9tbj4NCiAgICAgICAgPG1vPiYjeDIyMTI7PC9tbz4NCiAgICAgICAgPG1uPjg8L21uPg0KICAgICAgICA8bWk+cjwvbWk+DQogICAgICA8L210ZD4NCiAgICAgIDxtdGQ+DQogICAgICAgIDxtaT48L21pPg0KICAgICAgICA8bXJvdz4NCiAgICAgICAgICA8bW8gc3RyZXRjaHk9ImZhbHNlIj58PC9tbz4NCiAgICAgICAgPC9tcm93Pg0KICAgICAgICA8bW8+JiN4MjIxMjs8L21vPg0KICAgICAgICA8bW4+ODwvbW4+DQogICAgICAgIDxtbz47PC9tbz4NCiAgICAgICAgPG1vPiYjeEY3OzwvbW8+DQogICAgICAgIDxtbyBzdHJldGNoeT0iZmFsc2UiPig8L21vPg0KICAgICAgICA8bW8+JiN4MjIxMjs8L21vPg0KICAgICAgICA8bW4+ODwvbW4+DQogICAgICAgIDxtbyBzdHJldGNoeT0iZmFsc2UiPik8L21vPg0KICAgICAgPC9tdGQ+DQogICAgPC9tdHI+DQogICAgPG10cj4NCiAgICAgIDxtdGQ+DQogICAgICAgIDxtc3R5bGUgc2NyaXB0bGV2ZWw9IjAiPg0KICAgICAgICAgIDxtc3BhY2Ugd2lkdGg9InRoaWNrbWF0aHNwYWNlIj48L21zcGFjZT4NCiAgICAgICAgPC9tc3R5bGU+DQogICAgICAgIDxtbyBzdHJldGNoeT0iZmFsc2UiPiYjeDI3RkE7PC9tbz4NCiAgICAgICAgPG1zdHlsZSBzY3JpcHRsZXZlbD0iMCI+DQogICAgICAgICAgPG1zcGFjZSB3aWR0aD0idGhpY2ttYXRoc3BhY2UiPjwvbXNwYWNlPg0KICAgICAgICA8L21zdHlsZT4NCiAgICAgIDwvbXRkPg0KICAgICAgPG10ZD4NCiAgICAgICAgPG1uPjAuNTwvbW4+DQogICAgICAgIDxtbz49PC9tbz4NCiAgICAgICAgPG1pPnI8L21pPg0KICAgICAgPC9tdGQ+DQogICAgPC9tdHI+DQogIDwvbXRhYmxlPg0KPC9tYXRoPg0KDQoNCg==" download="power-analysis-by-data-simulation-in-r-part-iii.Rmd">Download power-analysis-by-data-simulation-in-r-part-iii.Rmd</a>
<style type="text/css">
button.btn.collapsed:before
{
    content:'+' ;
    display:block;
    width:15px;
}
button.btn:before
{
    content:'-' ;
    display:block;
    width:15px;
}
</style>
<p><em>This blog is also available on <a href="https://www.r-bloggers.com/">R-Bloggers</a></em></p>
<div id="the-power-analysis-by-simulation-in-r-for-really-any-design---part-iii" class="section level1">
<h1>The Power Analysis by simulation in <code>R</code> for really any design - Part III</h1>
<p>This is Part III of my tutorial on how to do power-analysis by simulation.
In Part I, we saw how to do a simulation for a simple toy-example with a coin-toss.
In part II we learned how to simulate univariate and multivariate normal-distributions, specify our assumptions about the expected effect and test our simulated data with different t-tests.
In this part, we will focus on how we can write a flexible test for any model by making use of the fact that many statistical standard methods (e.g. t-test, ANOVA) can be rewritten as a linear model.
This way, no matter what situation we find ourselves in, we will always be able to use the same power-simulation with only slight changes.</p>
<p>In part IV we will learn how to apply this technique to complicated designs such as linear mixed-effects models and generalized mixed-effects models.</p>
<div id="revisiting-the-t-test-just-another-linear-model" class="section level2">
<h2>Revisiting the t-test: just another linear model</h2>
<p>Before I even start with this topic, I want to point out that I took much of the information I present here from Jonas Kristoffer Lindelov’s <strong>fantastic</strong> blog post <a href="https://lindeloev.github.io/tests-as-linear/">“Common statistical tests are linear models (or: how to teach stats)”</a>.
If you have not read it yet, you should definitely do so, either now or after you finished this part of the tutorial.
Seriously, it is a great blog-post that inspired me to write up this part of the tutorial in a similar way in which we want to learn one flexible method of data-simulation rather than changing what we are doing for each different situation.</p>
<p>Ok so what does it mean to say that, for instance, a t-test is just a linear model?
First of all, here is a quick reminder about the linear model with a quick example:</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1x_i
\]</span></p>
<p>The above formula states that each value of y (the little i can be read as “each”) can be described by adding a value <span class="math inline">\(\beta_0\)</span> and the product of <span class="math inline">\(beta_0 \times x\)</span>.
Now, how does this relate to the t-test? Again, if you want a more in-depth discussion read the blog-post above.
To demonstrate the point, lets revisit the example from part II of this tutorial.
We had 2 groups and we assumed that one group can be described as <code>group1 = normal(0,2)</code> and the other group can be described as <code>group2 = normal(1,2)</code>.
Now if we want to test whether the difference in means is significant, we can run a independent-samples t-test.
However, if we rephrase the problem what we want to know whether group membership (whether you belong to group1 or group2; the <span class="math inline">\(x\)</span> variable in this case) significantly <em>predicts</em> the person’s score (y in this case).
To do so, we can just assume let <span class="math inline">\(beta_0\)</span> describe the mean of, say, group1 in this case.
If we do this and if we re-write model above to predict the mean of group1, it looks the following way:</p>
<p><span class="math display">\[
M_{group1} = M_{group1}+\beta_1\times x
\]</span></p>
<p>What should <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(x\)</span> be in this case?
Well, as we already have the mean of group1 on the right side in the term that was previously <span class="math inline">\(beta_0\)</span>, we do not want to add <em>anything</em> to it.
Thus, if someone member from group1, to predict the mean-score we should have an observed value for group-membership of 0.
This way, the formula becomes</p>
<p><span class="math display">\[
M_{group1} = M_{group1}+\beta_1\times 0
\]</span></p>
<p>and the <span class="math inline">\(\beta_1\)</span> term becomes 0 entirely. Note that we of course do not know the mean of group1 as we will <em>simulate</em> it.
<span class="math inline">\(\beta_0\)</span> (or <span class="math inline">\(M_{group1}\)</span> here) is a <em>parameter</em>, i.e. something that we want the model to estimate because we do not know it.</p>
<p>What if we want to describe the mean of a person in group2?
We can do this by just adding something to the mean of group1, namely the <em>difference</em> between the two groups.
In other words, we can describe the mean of group2 by saying its the mean of group1 + the difference of their means times x:</p>
<p><span class="math display">\[
M_{group2} = M_{group1}+(M_{group2}-M_{group1})\times x
\]</span></p>
<p>What should <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(x\)</span> be now?
Just like <span class="math inline">\(\beta_0\)</span>, our new mean-difference parameter <span class="math inline">\(\beta_1\)</span> is an unknown that depends on our simulated means and will be estimated by the model.
<span class="math inline">\(x\)</span> on the other hand should be 1, because if someone is from group2 we want the predicted mean of that person to be the mean of group1 + <strong>1 times</strong> the difference between group1 and group2.</p>
<p>Therefore if someone is from group2 our model becomes:</p>
<p><span class="math display">\[
M_{group2} = M_{group1}+(M_{group2}-M_{group1})\times 1
\]</span></p>
<p>What we just did is so-called <em>dummy coding</em>, i.e. we made a new dummy variable that tells us someone’s group membership:</p>
<ul>
<li>0 if the person is in group1</li>
<li>1 if the person is in group2</li>
</ul>
<p>If we use this dummy variable in the linear model we can do exactly the same test that we did with the t-test earlier.
Let me demonstrate with the exact same groups that we simulated in the beginning of part II of this tutorial.</p>
<pre class="r"><code>set.seed(1234)
group1 &lt;- rnorm(30, 1, 2)
group2 &lt;- rnorm(30, 0, 2)</code></pre>
<p>Now we can run the independent-samples t-test again, yielding the same results as in part II.</p>
<pre class="r"><code>t.test(group1, group2, paired = FALSE, var.equal = TRUE, conf.level = 0.9)</code></pre>
<pre><code>## 
##  Two Sample t-test
## 
## data:  group1 and group2
## t = 3.1402, df = 58, p-value = 0.002656
## alternative hypothesis: true difference in means is not equal to 0
## 90 percent confidence interval:
##  0.7064042 2.3143690
## sample estimates:
## mean of x mean of y 
##  0.407150 -1.103237</code></pre>
<p>To do our linear model analysis instead, we first have to create a data-frame that contains the 2 groups and tells us about their group membership.
In other words we will make a data-set that has the variables <code>score</code> which are the values in the vectors of group1 and group2 and a variable <code>group</code> that will be 0 if a person is from group1 and 1 if the person is from group2.
In this case, after putting the data together, we create a dummy variable with <code>ifelse</code> a function that you can read like: if the group variable has value “group1” in a certain row, then make dummy_group in that row = 0, else make it 1.</p>
<pre class="r"><code>names(group1) &lt;- rep(&quot;group1&quot;, length(group1)) # name the vectors to use the names as the group variable
names(group2) &lt;- rep(&quot;group2&quot;, length(group2))

lm_groupdat &lt;- data.frame(score = c(group1,group2), group = c(names(group1), names(group2))) # make data-set from scores and names

lm_groupdat$dummy_group &lt;- ifelse(lm_groupdat$group == &quot;group1&quot;, 0, 1) # create dummy variable </code></pre>
<p>Now we can use this to run our linear model with the <code>lm</code> function.
In case you have not used it before, we indicate the <em>intercept</em>, i.e. <span class="math inline">\(beta_0\)</span> with a 1 in this case, to tell the model that we want 1 times <span class="math inline">\(beta_0\)</span> in there and tell it that we want dummy_group times the difference between the groups, <span class="math inline">\(beta_1\)</span> in there.
The code looks like this:</p>
<pre class="r"><code>summary(lm(score ~ 1+ dummy_group, dat = lm_groupdat)) # use summary function to get p-values</code></pre>
<pre><code>## 
## Call:
## lm(formula = score ~ 1 + dummy_group, data = lm_groupdat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.0985 -1.1327 -0.4088  0.7360  5.4245 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)   0.4072     0.3401   1.197  0.23612   
## dummy_group  -1.5104     0.4810  -3.140  0.00266 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.863 on 58 degrees of freedom
## Multiple R-squared:  0.1453, Adjusted R-squared:  0.1306 
## F-statistic: 9.861 on 1 and 58 DF,  p-value: 0.002656</code></pre>
<p>First let us see what the estimates mean in this case.
The intercept has an estimate of .4072.
As we said earlier, this, <span class="math inline">\(\beta_0\)</span>, should be the group-mean of group1 and indeed wee see that <code>mean(group1)</code> = 0.40715 gives us the same result.
What is the second estimate, <span class="math inline">\(\beta_1\)</span> for dummy_group should yield the difference between the means.
We can confirm that <code>mean(group2)-mean(group1)</code> = -1.5103866 gives us the same result in this case.
Further we see that the DFs, t-value and p-value are identical to the earlier t-test.</p>
<p>This method would also work with the one-sample t-test approach and the paired-samples t-test approach from part II of the tutorial, but I will leave it as an exercise to the reader to try it out, as I do want to move on to other situations.
Again (cannot mention this enough) make sure you head to Jonas Kristoffer Lindelov’s <a href="https://lindeloev.github.io/tests-as-linear/">blog post</a> if you want to see how to do this or if you want to read more on this topic.</p>
</div>
<div id="simulating-a-2x2-between-subject-anova-as-a-linear-model" class="section level2">
<h2>Simulating a 2x2 between-subject ANOVA (as a linear model)</h2>
<div id="how-to-specify-raw-effect-sizes-with-no-prior-data" class="section level3">
<h3>How to specify raw effect-sizes with no prior data</h3>
<p>In this part, I will give an example of how we could specify prior effect-sizes for our research design given we have not collected any prior data and are only working with assumptions.</p>
<p>Ok time to move on to more sophisticated designs.
Imagine you are interested in students attitude towards smoking and how it depends on the medium of the message and the focus of the message.
More precisely we want to know whether people’s attitude is different after seeing a visual anti-smoking message (these pictures on the package) vs a text-message (the text belonging to that picture).
Moreover, we are interested in whether the attitude that people report is different after seeing a message that regards the consequences on other people (e.g. smoking can harm your loved ones) as compared to yourself (smoking can cause cancer).
Thus we have the following design</p>
<p><em>Disclaimer: This is just an example that i made up so it does not reflect any real-life effect and one might easily argue a different way as this RQ is not based on any underlying theory but it allows me to demonstrate the point without further elaborating on any psychological theory.</em></p>
<p>DV: attitude towards smoking (0-100)
IV1: medium (text vs. visual)
IV2: focus (internal vs. external)</p>
<p>This is, there are 4 groups:</p>
<ul>
<li>group_TI will receive text-messages that are internal</li>
<li>group_TE will receive text-messages that are external</li>
<li>group_VI will receive visual messages that are internal</li>
<li>group_VE will receive visual messages that are external</li>
</ul>
<p>Lets assume that we expect that people’s attitude will be more negative after seeing a visual rather than text message if the focus is internal (i.e. the message is about yourself) because it might be difficult to imagine that oneself would get cancer after reading a text but seeing a picture might cause fear regardless.
For the external focus on the other hand, we expect a more negative attitude after reading a text as compared to seeing a picture, as it might have more impact on attitude to imagine a loved one get hurt than seeing a stranger in a picture suffering from the consequences of second-hand smoking.
Furthermore, we expect that the internal focus messages will be related to lower attitudes compared to the external focus messages on average but we expect no main-effect of picture vs. text-messages.</p>
<p>Thus, we expect:</p>
<ul>
<li>no main-effect of medium</li>
<li>main-effect of focus</li>
<li>crossover-interaction of medium x focus</li>
</ul>
<p>At this point, in my opinion it is more difficult to work with standardized effect-sizes like partial correlations e.g. in this case then just to specify everything on the response scale directly.
A first good step is to visualize some rough means that show the desired behavior that we described in words earlier and see where we are going, starting with the main-effects.</p>
<p>We expect a main effect of focus so the means of the 2 internal groups should be lower (more negative attitude) than the means of the external groups.
For example, we could make the overall mean of the internal focus groups (group_TI and group_VI) 20 and the mean of the external groups (group_TE and group_VE) 50.
Note how this would already reflect the main-effect but also a belief that the smoking-attitudes are on average quite negative as we assume both means to be on the low end of the scale.
However, for now we just want to make a rough guess and we might adjust our expectations in a second.</p>
<p>Ok so now what we have to do is specify the means for the media groups in a way that reflects our interaction hypothesis.
We could for example assume that the mean of group_TI is 30 while the mean of group_VI is 10 and we could assume that the mean of group_TE is 40 and the mean of group_VE is 60.</p>
<p>This way, for the internal groups, visual messages are more negative than texts, while for the external groups texts are more negative than visual messages.</p>
<p>We could plot this to see how it looks like</p>
<pre class="r"><code>focus &lt;- rep(c(&quot;internal&quot;, &quot;external&quot;), each = 2)
media &lt;- rep(c(&quot;text&quot;, &quot;visual&quot;), times = 2)
mean_TI &lt;- 50
mean_VI &lt;- 20
mean_TE &lt;- 30
mean_VE &lt;- 60

pd &lt;- data.frame(score = c(mean_TI, mean_VI, mean_TE, mean_VE), focus = focus, media = media)

interaction.plot(pd$focus, pd$media, pd$score, ylim = c(0,100))</code></pre>
<p><img src="/post/2020-06-16-power-analysis-by-data-simulation-in-r-part-iii_files/figure-html/plot_exp1-1.png" width="672" /></p>
<pre class="r"><code>mean(pd$score[pd$focus == &quot;internal&quot;]) != mean(pd$score[pd$focus == &quot;external&quot;])</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>mean(pd$score[pd$media == &quot;text&quot;]) == mean(pd$score[pd$media == &quot;visual&quot;])</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>We can see that the above situation satisfies all things that we wanted to specify:</p>
<ul>
<li>The means of the two focus groups are not the same so that internal are lower than external values if we pool over the media conditions.</li>
<li>The mean for both media conditions are the same so there is no main-effect.</li>
<li>The lines cross over showing the interaction that we wanted.</li>
</ul>
<p>However, three problems remain here.
First of all, the simple slope for the visual messages is steeper than the simple slope for the text messages, which is not something we specified in our hypotheses beforehand.
It rather comes as a side-effect of that we want our internal means to be lower than the external means but we also want the visual messages to be more impactful in the internal condition while our text-messages should be more impactful on the external conditions.
Do we find this plausible or do we think this would rather be the other way around?</p>
<div class="notebox">
<p>
This a good point for a short reflection: You might already be overwhelmed how complicated power-analysis by simulation already is with these still relatively simple designs.
However, notice that e.g. the follow-up tests for the slopes are things that we <em>can</em> care about but we do not <em>need</em> to care about them.
Our interaction-hypothesis is mainly interested in whether the difference in scores between the visual and the text messages when comparing the internal focus group is the same as the difference for the external groups.
As this is clearly not the case in this example, we are good to go and test the interaction hypothesis.
However, if we clearly are interested in the simple slopes and have hypotheses about them, we <em>can</em> put it in our simulation, and that of course urges us to think some more but it is a <em>great</em> tool to see whether we actually thought about everything, as this might be a point that would have slipped our attention entirely when running a classical power-analysis and pre-registering the overall interaction only.
Now, we can think about it if we <em>want</em> to or continue by saying that for now we only want to specify the interaction.
</p>
</div>
<p>Let us assume that we are fine with the fact that visual messages differ somewhat more than text messages.
However, the numbers we have chosen so far are all but plausible.
In this case, if we want to come up with more plausible numbers it is good if, instead of thinking about means directly, we make assumptions about how each of the group-means will differ from the overall <em>population</em> mean.
For instance, we can assume in this case that all groups might actually have a more negative attitude towards smoking after seeing the text or visual message no matter whether they were externally and internally (ideally we would of course use a pre-post test design but lets keep that for later).
Thus, we could for example assume that (having no better data on this) people are on average indifferent about smoking, therefore assuming the population mean is 50.
Now lets see what this would imply in terms of change scores for the numbers above:</p>
<pre class="r"><code>change_TI &lt;- mean_TI-50
change_VI &lt;- mean_VI-50
change_TE &lt;- mean_TE-50
change_VE &lt;- mean_VE-50

barplot(c(change_TI, change_VI, change_TE, change_VE), names.arg = c(&quot;TI&quot;, &quot;VI&quot;, &quot;TE&quot;, &quot;VE&quot;))</code></pre>
<p><img src="/post/2020-06-16-power-analysis-by-data-simulation-in-r-part-iii_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Thus, this does not seem entirely plausible.
The VE group increases in their attitude towards cigarettes compared to the assumed population mean and the TI group does not change at all.
This is not what we would expect.
However, as we want to keep the rank-order of the bars the same (i.e. order of difference-magnitudes between the groups should stay the same as above) we will start with the highest bar here and adjust it to a position where it would actually make sense compared to the population mean.
Lets assume that the looking at these external pictures would actually decrease the population mean of smoking attitude by 3 points on average.
This is just a consequence of that I think an intervention of this would be rather weak as most people do not see these pictures for the first time and also might not be influences so much by looking at them to begin with.
Thus my mean of group_VE becomes 47.</p>
<p>Next, when looking at the TI group, I think hat this group might decrease more strongly compared to the other group (it is internal), so the new mean after reading texts about yourself might be 45 in this case.</p>
<p>The next group is the TE group which should be lower than the other two groups before. However given that it is also an external group, and I expect internal messages to work better, it is probably not much stronger than the TI group, so I will assume the mean is 43.</p>
<p>Last, the strongest of the changes I would probably expect for the VI group so I can assume that the change might be 10 points in this case so that their mean will become 40.</p>
<p>Let us plot these new means again.</p>
<pre class="r"><code>focus &lt;- rep(c(&quot;internal&quot;, &quot;external&quot;), each = 2)
media &lt;- rep(c(&quot;text&quot;, &quot;visual&quot;), times = 2)
mean_TI &lt;- 43
mean_VI &lt;- 40
mean_TE &lt;- 45
mean_VE &lt;- 47

pd &lt;- data.frame(score = c(mean_TI, mean_VI, mean_TE, mean_VE), focus = focus, media = media)

interaction.plot(pd$focus, pd$media, pd$score, ylim = c(0,100))</code></pre>
<p><img src="/post/2020-06-16-power-analysis-by-data-simulation-in-r-part-iii_files/figure-html/plot_exp2-1.png" width="672" /></p>
<pre class="r"><code>mean(pd$score[pd$focus == &quot;internal&quot;]) != mean(pd$score[pd$focus == &quot;external&quot;])</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>mean(pd$score[pd$media == &quot;text&quot;]) == mean(pd$score[pd$media == &quot;visual&quot;])</code></pre>
<pre><code>## [1] FALSE</code></pre>
<p>Note that in this new example, technically there is a difference between the two media groups on average but it is only .50 points, so I would argue that it is small enough to represent our assumption of “no” effect, as in real-life “no” effect in terms of a difference being actually 0 is rather rare anyway.</p>
<p>Ok, so after rule-of-thumbing our way through all the different group-means, we have to consider what standard deviation we find plausible in this situation.</p>
<p>It is plausible, that the intervention that we are administering might not directly influence the spread in each group, so we might as well assume that the spread is the same in each group.
What should we choose in this case?
Let us think about the population.
We said that people would in average be indifferent about smoking with a mean of 50 on a 100-point scale.
How big should the spread on this scale be, i.e. between which values do we assume most people to be on this scale.
It is probably likely that most people will not have a very good attitude about smoking, say 80 or higher.
The lower end is more difficult to predict in this case, there might as well be more people that have a very negative opinion.
In fact, the distribution might be skewed rather than symmetric, with more people having very negative opinions and a rather long tail.
In any case, we will use this upper-limit assumption to come up with some reasonable standard-deviation.
If we start at 50 and we want most people to be &lt; 80, we can set the 2-SD bound at 80 to get a standard-deviation of 15 (80-50)/2.
Thus let us assume that each of our groups has a standard-deviation of 15 points.</p>
<p>Thus our distributions that we would have are</p>
<pre><code>group_TI = normal(n, 43, 15)
group_VI = normal(n, 40, 15)
group_TE = normal(n, 45, 15)
group_VE = normal(n, 47, 15)</code></pre>
<p>With these groups we can now run an ANOVA.
Before getting into the power-analysis part lets just have a look what would happen if we had 10,000 people per group and would use this in our ANOVA.
First we will do this by using the <code>aov_car</code> function from the <code>afex</code> package.</p>
<pre><code>## Loading required package: afex</code></pre>
<pre><code>## Loading required package: lme4</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## Registered S3 methods overwritten by &#39;car&#39;:
##   method                          from
##   influence.merMod                lme4
##   cooks.distance.influence.merMod lme4
##   dfbeta.influence.merMod         lme4
##   dfbetas.influence.merMod        lme4</code></pre>
<pre><code>## ************
## Welcome to afex. For support visit: http://afex.singmann.science/</code></pre>
<pre><code>## - Functions for ANOVAs: aov_car(), aov_ez(), and aov_4()
## - Methods for calculating p-values with mixed(): &#39;KR&#39;, &#39;S&#39;, &#39;LRT&#39;, and &#39;PB&#39;
## - &#39;afex_aov&#39; and &#39;mixed&#39; objects can be passed to emmeans() for follow-up tests
## - NEWS: library(&#39;emmeans&#39;) now needs to be called explicitly!
## - Get and set global package options with: afex_options()
## - Set orthogonal sum-to-zero contrasts globally: set_sum_contrasts()
## - For example analyses see: browseVignettes(&quot;afex&quot;)
## ************</code></pre>
<pre><code>## 
## Attaching package: &#39;afex&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:lme4&#39;:
## 
##     lmer</code></pre>
<pre class="r"><code>require(afex)</code></pre>
<pre class="r"><code>n &lt;- 1e5
group_TI &lt;-  rnorm(n, 43, 15)
group_VI &lt;-  rnorm(n, 40, 15)
group_TE &lt;-  rnorm(n, 45, 15)
group_VE &lt;-  rnorm(n, 47, 15)

participant &lt;- c(1:(n*4))
focus &lt;- rep(c(&quot;internal&quot;, &quot;external&quot;), each = n*2)
media &lt;- rep(c(&quot;text&quot;, &quot;visual&quot;), each = n, times = 2)

aov_dat &lt;- data.frame(participant = participant, focus = focus, media = media, score = c(group_TI, group_VI, group_TE, group_VE))


aov_car(score ~ focus*media+ Error(participant), data = aov_dat, type = 3)</code></pre>
<pre><code>## Contrasts set to contr.sum for the following variables: focus, media</code></pre>
<pre><code>## Anova Table (Type 3 tests)
## 
## Response: score
##        Effect        df    MSE           F   ges p.value
## 1       focus 1, 399996 225.28 8811.28 ***   .02  &lt;.0001
## 2       media 1, 399996 225.28  126.75 *** .0003  &lt;.0001
## 3 focus:media 1, 399996 225.28 2703.27 ***  .007  &lt;.0001
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;+&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We see that, if we collect 10,000 people per group, everything would be significant with focus having the biggest effect (look at the <code>ges</code> column in the table for generalized eta-squared values) and with media having the smallest effect (in fact close to 0 as we wanted).
That even the main-effect for media is still significant just shows that this happens even with very small deviations from the exact null-hypothesis in these huge samples.</p>
<p>Note that again we could rewrite this anova as a dummy-coded linear model as:</p>
<p><span class="math display">\[
score_i = \beta_0 + \beta_1X_1 + \beta_2X_2 + \beta_3X_1X_2 
\]</span></p>
<p>By making dummy-variables we can code this in <code>lm</code></p>
<pre class="r"><code>aov_dat$focus_dummy &lt;- ifelse(aov_dat$focus == &quot;internal&quot;, 0 , 1)
aov_dat$media_dummy &lt;- ifelse(aov_dat$media == &quot;text&quot;, 0 , 1)

lm_int &lt;- lm(score ~ 1 + focus_dummy + media_dummy + focus_dummy:media_dummy, data = aov_dat)</code></pre>
<p>From the estimates that we get here we see how the model is estimated:</p>
<p><span class="math inline">\(\beta_0\)</span> = <code>mean(group_TI)</code> as both dummies are 0 for this one.
<span class="math inline">\(\beta_1\)</span> = <code>mean(group_TE)-mean(group_TI)</code> as the focus variable changes from 0 to 1 within the text-group
<span class="math inline">\(\beta_2\)</span> = <code>mean(group_VI)-mean(group_TI)</code> as the media variable changes from 0 to 1 within the internal focus group
<span class="math inline">\(\beta_3\)</span> = <code>mean(group_VE)-mean(group_TE)+mean(group_TI)-mean(group_VI)</code> to see what a crossover of the variables (i.e. the interaction) compares to <span class="math inline">\(\beta_0\)</span></p>
<p>If we want to test whether the effect of the interaction, for instance is significant, we can conduct an ANOVA for the interaction to see how the model <em>with</em> the interaction compares to a model <em>without</em> the interaction, which we do in the following code-block by fitting a model that does not have the interaction in their and compare it with the <code>anova</code> function.</p>
<pre class="r"><code>lm_null &lt;- lm(score ~ 1 + focus_dummy + media_dummy, data = aov_dat)
anova(lm_null, lm_int)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Model 1: score ~ 1 + focus_dummy + media_dummy
## Model 2: score ~ 1 + focus_dummy + media_dummy + focus_dummy:media_dummy
##   Res.Df      RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1 399997 90721027                                  
## 2 399996 90112027  1    609000 2703.3 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Again, we find the same F-value and p-value as before, which should not be surprising considering we did the same test.
I will leave it to you which of the two methods, i.e. using the regular <code>aov</code> functions or specifying linear models, you prefer.
An obvious advantage of the <code>aov</code> function is that we do not have to specify nested models but it is also sort of a black-box approach, while in the linear models, we get estimated effects and can see whether the model does actually behaves as we would expect.</p>
</div>
<div id="quick-detour-contrast-coding-and-centering" class="section level3">
<h3>Quick detour: Contrast Coding and Centering</h3>
<p>Going back to the <code>aov_car</code> output above, you might have noticed that the function informed us that it <em>set [contrasts] to contr.sum for the following variables: focus, media</em>.
What does this mean?
It means that instead of using dummy-coding as we did when we created the dummy variables, it instead assigned a -1 to a level of the variable while setting a 1 to the other level.
We can check what this looks like if we set it manually to the variables in the data-set.</p>
<pre class="r"><code>aov_dat$media_sum &lt;- factor(aov_dat$media)
contrasts(aov_dat$media_sum) &lt;- contr.sum(2)
contrasts(aov_dat$media_sum)</code></pre>
<pre><code>##        [,1]
## text      1
## visual   -1</code></pre>
<pre class="r"><code>aov_dat$focus_sum &lt;- factor(aov_dat$focus)
contrasts(aov_dat$focus_sum) &lt;- contr.sum(2)
contrasts(aov_dat$focus_sum)</code></pre>
<pre><code>##          [,1]
## external    1
## internal   -1</code></pre>
<p>If we compare this to our dummy variables:</p>
<p>media:</p>
<ul>
<li>text = 0</li>
<li>visual = 1</li>
</ul>
<p>focus:</p>
<ul>
<li>internal = 0</li>
<li>external = 1</li>
</ul>
<p>Let’s re-run the linear model with these variables and see what we get.</p>
<pre class="r"><code>aov_dat$media_sum_num &lt;- ifelse(aov_dat$media == &quot;text&quot;, 1, -1)
aov_dat$focus_sum_num &lt;- ifelse(aov_dat$focus == &quot;external&quot;, 1, -1)

lm_int_sum &lt;- lm(score ~ 1 + focus_sum_num + media_sum_num + focus_sum_num:media_sum_num, data = aov_dat)
lm_int_sum</code></pre>
<pre><code>## 
## Call:
## lm(formula = score ~ 1 + focus_sum_num + media_sum_num + focus_sum_num:media_sum_num, 
##     data = aov_dat)
## 
## Coefficients:
##                 (Intercept)                focus_sum_num  
##                     43.7756                       2.2277  
##               media_sum_num  focus_sum_num:media_sum_num  
##                      0.2672                      -1.2339</code></pre>
<pre class="r"><code>lm_null_sum &lt;- lm(score ~ 1 + focus_sum_num + media_sum_num, data = aov_dat)
lm_null_sum</code></pre>
<pre><code>## 
## Call:
## lm(formula = score ~ 1 + focus_sum_num + media_sum_num, data = aov_dat)
## 
## Coefficients:
##   (Intercept)  focus_sum_num  media_sum_num  
##       43.7756         2.2277         0.2672</code></pre>
<pre class="r"><code>anova(lm_null_sum,lm_int_sum)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Model 1: score ~ 1 + focus_sum_num + media_sum_num
## Model 2: score ~ 1 + focus_sum_num + media_sum_num + focus_sum_num:media_sum_num
##   Res.Df      RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1 399997 90721027                                  
## 2 399996 90112027  1    609000 2703.3 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We see immediately that the estimates changed somewhat.
Now, for example the intercept represents the mean of all 4 other means (i.e. the grand mean):</p>
<p><code>mean(c(mean(group_TI), mean(group_TE), mean(group_VE), mean(group_VI)))</code> = 43.775609.</p>
<p>and the first estimate represents the difference of each focus level from that grand-mean, for the “internal groups this is”</p>
<p><code>mean(c(mean(group_TI), mean(group_VI)))-mean(c(mean(group_TI), mean(group_TE), mean(group_VE), mean(group_VI)))</code> = -2.2276811</p>
<p>and for the external groups this is</p>
<p><code>mean(c(mean(group_TE), mean(group_VE)))-mean(c(mean(group_TI), mean(group_TE), mean(group_VE), mean(group_VI)))</code> = 2.2276811</p>
<p>respectively.</p>
<p>Why would we use this coding-scheme in the linear model instead of the other one?
The p-value for the interaction is exactly the same in both cases.
However, if we compare the p-values of main-effects here, we will see how they differ.</p>
<p>For instance, if we tell <code>aov_car</code> that we want to keep our dummy-coding instead of changing it, we can see how the two outputs differ.</p>
<pre class="r"><code>aov_car(score ~ focus*media+ Error(participant), data = aov_dat, type = 3, afex_options(&quot;check_contrasts&quot; = FALSE))</code></pre>
<pre><code>## Anova Table (Type 3 tests)
## 
## Response: score
##        Effect        df    MSE           F  ges p.value
## 1       focus 1, 399996 225.28  876.77 *** .002  &lt;.0001
## 2       media 1, 399996 225.28  829.66 *** .002  &lt;.0001
## 3 focus:media 1, 399996 225.28 2703.27 *** .007  &lt;.0001
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;+&#39; 0.1 &#39; &#39; 1</code></pre>
<p>As you can see, these results are a bit weird, as we seem to have the same effect-size for both main-effects, but did we not simulate a much bigger effect of focus compared to media<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>?
Something seems to be off here.
This has to do with the fact that in classical dummy-coding (also called treatment coding) you cannot easily test main-effects when interactions are present in the model.
For the interaction on the other hand it does not matter.
You can read more about this in <a href="http://talklab.psy.gla.ac.uk/tvw/catpred/#why-does-it-matter">this blog post by Dale Barr</a> but the take-home message here is that, whenever we have an interaction in our model, we want to use sum-to-zero coding rather than dummy-coding.
This is why the results of the last anova do not show the behavior that we simulated.</p>
<p>Thus, for the rest of the tutorial we will use sum-to-zero contrasts coding.</p>
</div>
<div id="running-the-power-analysis" class="section level3">
<h3>Running the power-analysis</h3>
<p>I will use the <code>lm</code> way here as it is much faster (about 8 times faster in a quick test) than the <code>aov_car</code> method.
To track our power, we can directly extract p-values from the <code>anova</code> object, just as we did for the <code>t.test</code> objects earlier.</p>
<p>The only thing that we still need to do is specify our test criteria.
Imagine that this time we are hired by the government and are asked to evaluate which of the health-warnings on cigarette packages would work best in which of the situations that we investigate.
They gave us a lot of money to do this, but they do not want to draw any conclusions that are unwarranted as implementing new laws costs a lot of money.
Thus, we want to set our alpha-level quite conservatively at <span class="math inline">\(\alpha = .001\)</span> to only make a non-warranted claim about the interaction effect in 1 of every 1,000 experiments.
Moreover, we also want to be sure that we actually detect an effect and therefore want to keep our power high at 95% to be sure that if there <em>is</em> an interaction we would detect it in 19 out of 20 cases.</p>
<p>Now we have everything that we need to set up the code-chunk below to run a power-analysis similar to the ones we have been running previously, just this time with an ANOVA coded as a linear model.
If we would again try out every sample-size, this would take a very long time until we reach our power criterion and we would probably still be sitting here tomorrow or the day after.
In these cases, it makes sense to run a two-stage power analysis in which we, in the first stage, try out various sample-sizes with a very low resolution (e.g. n = 10, n = 100, n = 200) etc. to get a rough idea of where we can expect our loop to end.
Afterwards, we will increase the resolution to find how many participants exactly we would need.
The first step with the low resolution is performed below.</p>
<pre class="r"><code>set.seed(1)
n_sims &lt;- 1000 # we want 1000 simulations
p_vals &lt;- c()
power_at_n &lt;- c(0) # this vector will contain the power for each sample-size (it needs the initial 0 for the while-loop to work)
n &lt;- 100 # sample-size and start at 100 as we can be pretty sure this will not suffice for such a small effect
n_increase &lt;- 100 # by which stepsize should n be increased
i &lt;- 2

power_crit &lt;- .95
alpha &lt;- .001

while(power_at_n[i-1] &lt; power_crit){
  for(sim in 1:n_sims){
    group_TI &lt;-  rnorm(n, 43, 15)
    group_VI &lt;-  rnorm(n, 40, 15)
    group_TE &lt;-  rnorm(n, 45, 15)
    group_VE &lt;-  rnorm(n, 47, 15)
    
    participant &lt;- c(1:(n*4))
    focus &lt;- rep(c(&quot;internal&quot;, &quot;external&quot;), each = n*2)
    media &lt;- rep(c(&quot;text&quot;, &quot;visual&quot;), each = n, times = 2)
    
    aov_dat &lt;- data.frame(participant = participant, focus = focus, media = media, score = c(group_TI, group_VI, group_TE, group_VE))
    aov_dat$media_sum_num &lt;- ifelse(aov_dat$media == &quot;text&quot;, 1, -1) # apply sum-to-zero coding
    aov_dat$focus_sum_num &lt;- ifelse(aov_dat$focus == &quot;external&quot;, 1, -1) 
    lm_int &lt;- lm(score ~ 1 + focus_sum_num + media_sum_num + focus_sum_num:media_sum_num, data = aov_dat) # fit the model with the interaction
    lm_null &lt;- lm(score ~ 1 + focus_sum_num + media_sum_num, data = aov_dat) # fit the model without the interaction
    p_vals[sim] &lt;- anova(lm_int, lm_null)$`Pr(&gt;F)`[2] # put the p-values in a list
  }
    print(n)
    power_at_n[i] &lt;- mean(p_vals &lt; alpha) # check power (i.e. proportion of p-values that are smaller than alpha-level of .10)
    names(power_at_n)[i] &lt;- n
    n &lt;- n+n_increase # increase sample-size by 100 for low-resolution testing first
    i &lt;- i+1 # increase index of the while-loop by 1 to save power and cohens d to vector
}</code></pre>
<pre><code>## [1] 100
## [1] 200
## [1] 300
## [1] 400
## [1] 500
## [1] 600
## [1] 700
## [1] 800
## [1] 900</code></pre>
<pre class="r"><code>power_at_n &lt;- power_at_n[-1] # delete first 0 from the vector</code></pre>
<pre class="r"><code>plot(as.numeric(names(power_at_n)), power_at_n, xlab = &quot;Number of participants per group&quot;, ylab = &quot;Power&quot;, ylim = c(0,1), axes = TRUE)
abline(h = .95, col = &quot;red&quot;)</code></pre>
<p><img src="/post/2020-06-16-power-analysis-by-data-simulation-in-r-part-iii_files/figure-html/plot_power_low_res-1.png" width="672" /></p>
<p>We see that at roughly 900 participants our loop ran into a situation where we have sufficient power.
Thank god we did not do this 1-by-1.
Now we can have a closer look at sample-sizes between 800 and 900.
Probably, at this sample-size it does not really matter whether we calculate +/- 10 participants in terms of budget, so we can start at 800 and increase in steps of 10 and instead increase the simulation-number per sample-size to 10,000 to get even more precise results for each particular sample-size, as this is a rather important power-analysis impact-wise.
Afterwards, if we <em>really</em> wanted to we could of course run a third round between the last two 10-people cutoffs and increase the sample-size by 1 to reach an exact sample-size.</p>
<pre class="r"><code>set.seed(1)
n_sims &lt;- 10000 # we want 10000 simulations
p_vals &lt;- c()
power_at_n &lt;- c(0) # this vector will contain the power for each sample-size (it needs the initial 0 for the while-loop to work)
delta_r2s&lt;- c()
delta_r2s_at_n &lt;- c(0)
n &lt;- 800 # sample-size and start at 800 as we can be pretty sure this will not suffice for such a small effect
n_increase &lt;- 10 # by which stepsize should n be increased
i &lt;- 2

power_crit &lt;- .95
alpha &lt;- .001

while(power_at_n[i-1] &lt; power_crit){
  for(sim in 1:n_sims){
    group_TI &lt;-  rnorm(n, 43, 15)
    group_VI &lt;-  rnorm(n, 40, 15)
    group_TE &lt;-  rnorm(n, 45, 15)
    group_VE &lt;-  rnorm(n, 47, 15)
    
    participant &lt;- c(1:(n*4))
    focus &lt;- rep(c(&quot;internal&quot;, &quot;external&quot;), each = n*2)
    media &lt;- rep(c(&quot;text&quot;, &quot;visual&quot;), each = n, times = 2)
    
    aov_dat &lt;- data.frame(participant = participant, focus = focus, media = media, score = c(group_TI, group_VI, group_TE, group_VE))
    aov_dat$media_sum_num &lt;- ifelse(aov_dat$media == &quot;text&quot;, 1, -1)
    aov_dat$focus_sum_num &lt;- ifelse(aov_dat$focus == &quot;external&quot;, 1, -1)
    lm_int &lt;- lm(score ~ 1 + focus_sum_num + media_sum_num + focus_sum_num:media_sum_num, data = aov_dat)
    lm_null &lt;- lm(score ~ 1 + focus_sum_num + media_sum_num, data = aov_dat)
    p_vals[sim] &lt;- anova(lm_null, lm_int)$`Pr(&gt;F)`[2]
    delta_r2s[sim]&lt;- summary(lm_int)$adj.r.squared-summary(lm_null)$adj.r.squared
    }
    print(n)
    power_at_n[i] &lt;- mean(p_vals &lt; alpha) # check power (i.e. proportion of p-values that are smaller than alpha-level of .10)
    delta_r2s_at_n[i] &lt;- mean(delta_r2s)
    names(power_at_n)[i] &lt;- n
    names(delta_r2s_at_n)[i] &lt;- n
    n &lt;- n+n_increase # increase sample-size by 100 for low-resolution testing first
    i &lt;- i+1 # increase index of the while-loop by 1 to save power and cohens d to vector
}</code></pre>
<pre><code>## [1] 800
## [1] 810
## [1] 820
## [1] 830
## [1] 840
## [1] 850
## [1] 860
## [1] 870
## [1] 880
## [1] 890</code></pre>
<pre class="r"><code>power_at_n &lt;- power_at_n[-1] # delete first 0 from the vector
delta_r2s_at_n &lt;- delta_r2s_at_n[-1] # delete first 0 from the vector</code></pre>
<p>As you will notice when you run this yourself, this simulation already takes quite some time.
Later, when we work with mixed models in part IV, we will see how we can run such a simulation on multiple processor-cores simultaneously to solve this problem to at least some extent.</p>
<pre class="r"><code>plot(as.numeric(names(power_at_n)), power_at_n, xlab = &quot;Number of participants per group&quot;, ylab = &quot;Power&quot;, ylim = c(0,1), axes = TRUE)
abline(h = .95, col = &quot;red&quot;)</code></pre>
<p><img src="/post/2020-06-16-power-analysis-by-data-simulation-in-r-part-iii_files/figure-html/plot_power-1.png" width="672" /></p>
<p>This power-curve looks a bit odd, as it looks almost flat.
What this shows however, is that power is not increasing linearly but tends to increase faster at the beginning and slower towards reaching 1.</p>
<p>In any case, 890 people <em>per group</em> would be enough to reach our desired power of .95.
Note how close this is to the 900 from our low-resolution simulation above, showing the merits of this approach.
Also note that the change in amount of variance explained <span class="math inline">\(\Delta R^2\)</span> only increases by about <code>delta_r2s_at_n[length(delta_r2s_at_n)]</code> = 0.0067977.
Whether this ~0.6% is a meaningful amount of added variance explained to begin with and whether it is worth spending money in order to test about 3,500 people without even knowing what this attitude measure in this case even tells us in terms of smoking-behavior is a whole other question and cannot be answered with power-analysis (probably the answer would be that it is not so important though).</p>
</div>
</div>
<div id="adding-a-numeric-predictor" class="section level2">
<h2>Adding a Numeric Predictor</h2>
<p>In this last bit of part III of this tutorial I want to demonstrate how we can add numeric predictors to our models as, so far, we only worked with factors.
Again, knowing how to re-specify an ANOVA as a linear model is helpful in this case if we have both, factorial and numerical predictors.</p>
<p>We could also assume that the effect that our predictors have depend on other factors.
For example, we could think that the more cigarettes a person smokes each day, the less effective any treatment would be independent of what strategy we would use.
Thus, if we assume that the aforementioned effect-sizes would be the expected value for a non-smoking population, including smokers would make this effect less pronounced.
In other words, the more a person smokes, the smaller the expected effect size for that person should be.</p>
<p>How do we do this?
If we reformulate our problem above we could say that if a person smokes 0 cigarettes a day she should get 100% of the expected effect (e.g. the decrease of 7 points in the internal text-group).
Now, we can take the maximum amount of cigarettes that we think a person can smoke per day (or what we expect the 95% CI to be in a smoking population for instance).
Let us say we assume this to be 36 cigarettes a day (about 2 packages).
Now if we want a person that smokes 0 cigarettes to get the full 7 points and a person who smokes 36 cigarettes to get 0 percent of the effect, we can rewrite the effect like this</p>
<p><span class="math display">\[y{_i} =  \bar y \times \frac{max_{n}-n}{max_n}\]</span></p>
<p>or if we fill in the numbers for a non-smoker:</p>
<p><span class="math display">\[y{_i} = 7 \times \frac{36-0}{36} = 7\]</span></p>
<p>and someone who smokes 14 cigarettes a day:</p>
<p><span class="math display">\[y{_i} = 7 \times \frac{36-14}{36} = 5.64\]</span></p>
<p>Thus, our effect of 7 points now depends on how much someone smokes.</p>
<p>Now we have to come up with an assumption of how much people smoke in the population.
A quick <a href="https://www.trimbos.nl/docs/9a7f5384-36fa-4edc-815f-1d0388960f46.pdf">google search</a> can tell us that, in the Netherlands, 23.1% of adults smoke.
We can also find that people who smoke consume ca. 11 cigarettes on average.
Thus, we will make a population in which 76.9 percent of the people do not smoke and 23.1 percent smokes 11 cigarettes on average.
For the cigarette count in the smoking population we will choose a <em>Poisson</em> distribution, as it is often a good representation of count-data like this.</p>
<div class="notebox">
<p>
You might never have heard of a Poisson distribution and to avoid confusion here: We could just use a uniform distribution between 1 and 36 for example so that smoking 30 cigarettes a day is just as likely as smoking 1 cigarette, given that a person is a smoker.
However, I do not think that this is the case and that the likelihood of a smoker smoking 30 cigarettes is smaller compared to only smoking 5 cigarettes.
The Poisson distribution mainly carries this assumption forward into the simulation.
As you continue simulating stuff in the future, you will probably get to know more of these useful distributions that neatly describe certain assumptions that we have about the data.
</p>
</div>
<p>To create a population like this we can do the following:</p>
<pre class="r"><code>n &lt;- 1000# sample size

smoke_yes_no &lt;- ifelse(runif(n, 0, 100) &lt; 77, 0, 1) # vector telling us whether each &quot;person&quot; smokes or not

n_smoke &lt;- c() # vector that will contain number of cigarettes per day smoked by each person

# create the number of smoked cigarettes
for(i in 1:length(smoke_yes_no)){ 
  if(smoke_yes_no[i] == 1){
    n_smoke[i] &lt;- rpois(1,11) # simulate 1 cigarette count from a poisson distribution with mean 11
  } else{ 
    n_smoke[i] &lt;- 0}
}</code></pre>
<p>In the above code we check for each person whether they are a smoker or not and if so, say that the person’s number of cigarettes smoked comes from a Poisson distribution or otherwise it will be 0 by definition.</p>
<p>To implement this for each group, we can just replace the means of the groups by this formula:</p>
<pre class="r"><code>set.seed(1234)
group_TI &lt;-  rnorm(n, (50-(7*((max(n_smoke)-n_smoke)/max(n_smoke)))), 15)
group_VI &lt;-  rnorm(n, (50-(10*((max(n_smoke)-n_smoke)/max(n_smoke)))), 15)
group_TE &lt;-  rnorm(n, (50-(5*((max(n_smoke)-n_smoke)/max(n_smoke)))), 15)
group_VE &lt;-  rnorm(n, (50-(3*((max(n_smoke)-n_smoke)/max(n_smoke)))), 15)

participant &lt;- c(1:(n*4))
focus &lt;- rep(c(&quot;internal&quot;, &quot;external&quot;), each = n*2)
media &lt;- rep(c(&quot;text&quot;, &quot;visual&quot;), each = n, times = 2)

aov_dat &lt;- data.frame(participant = participant, focus = focus, media = media, score = c(group_TI, group_VI, group_TE, group_VE))

aov_dat$media_sum_num &lt;- ifelse(aov_dat$media == &quot;text&quot;, 1, -1)
aov_dat$focus_sum_num &lt;- ifelse(aov_dat$focus == &quot;external&quot;, 1, -1)
aov_dat$n_smoke &lt;- rep(scale(n_smoke))

lm_int &lt;- lm(score ~ 1 + focus_sum_num * media_sum_num * n_smoke, data = aov_dat)
summary(lm_int)</code></pre>
<pre><code>## 
## Call:
## lm(formula = score ~ 1 + focus_sum_num * media_sum_num * n_smoke, 
##     data = aov_dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -50.287 -10.129   0.189   9.930  48.593 
## 
## Coefficients:
##                                     Estimate Std. Error t value
## (Intercept)                         44.44569    0.23621 188.160
## focus_sum_num                        2.12720    0.23621   9.005
## media_sum_num                        0.21372    0.23621   0.905
## n_smoke                              1.77929    0.23633   7.529
## focus_sum_num:media_sum_num         -0.81755    0.23621  -3.461
## focus_sum_num:n_smoke               -0.27972    0.23633  -1.184
## media_sum_num:n_smoke               -0.10452    0.23633  -0.442
## focus_sum_num:media_sum_num:n_smoke  0.06719    0.23633   0.284
##                                               Pr(&gt;|t|)    
## (Intercept)                                    &lt; 2e-16 ***
## focus_sum_num                                  &lt; 2e-16 ***
## media_sum_num                                 0.365634    
## n_smoke                             0.0000000000000629 ***
## focus_sum_num:media_sum_num                   0.000544 ***
## focus_sum_num:n_smoke                         0.236651    
## media_sum_num:n_smoke                         0.658334    
## focus_sum_num:media_sum_num:n_smoke           0.776180    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 14.94 on 3992 degrees of freedom
## Multiple R-squared:  0.03674,    Adjusted R-squared:  0.03505 
## F-statistic: 21.75 on 7 and 3992 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Note how the effects that we put in before are still there but they are weaker now as we have smokers included in our sample.
Moreover, smoking causes a more positive attitude towards smoking, just as we wanted, and the interaction between media and focus is not influenced by whether someone smokes or not, as we put the same punishment for the treatment effect in all the groups, leaving the interaction uninfluenced by whether someone smokes or not.</p>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<p>So now we have seen how we can simulate data for analyses that many people use in their everyday life as a (psychological) researcher.
So far, all of the power-analyses that we did can also be done in standard software like G*Power (though in part I of this tutorial I explained why I still prefer simulation).
However, as nice as these analyses are, we often deal with more complicated situations where we have to deal with hierarchical or cross-classified data.
In these cases, other approaches like linear-mixed effects models, also called hierarchical models, need to be used to analyse our data.
This is where simulation really shines as the structure of the data strongly depends on the research design and in a point-and-click software (though existing) it is difficult to offer all the flexibility that we might need.
Thus, in the fourth part, we will see how we can simulate data and run a power-analysis in these cases.</p>
</div>
</div>
<div id="footnotes" class="section level1">
<h1>Footnotes</h1>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>We can actually see that this is the case by calculating cohens d for both assuming that we would perform a t-test for each of the 2 factors with the between-subject cohens d formula from part II of this tutorial:
<strong>focus</strong>:
<code>(mean(aov_dat$score[aov_dat$focus == "internal"])-mean(aov_dat$score[aov_dat$focus == "external"]))/sqrt((sd(aov_dat$score[aov_dat$focus == "internal"])^2+sd(aov_dat$score[aov_dat$focus == "external"])^2)/2)</code> = -0.2824849
<strong>media</strong>:
<code>(mean(aov_dat$score[aov_dat$media == "text"])-mean(aov_dat$score[aov_dat$media == "visual"]))/sqrt((sd(aov_dat$score[aov_dat$media == "text"])^2+sd(aov_dat$score[aov_dat$media == "visual"])^2)/2)</code> = 0.0281052<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>

    </div>



    





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/power/">power</a>
  
  <a class="badge badge-light" href="/tags/data-simulation/">data-simulation</a>
  
  <a class="badge badge-light" href="/tags/r/">R</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=https://julianquandt.com/post/power-analysis-by-data-simulation-in-r-part-iii/&amp;text=Power%20Analysis%20by%20Data%20Simulation%20in%20R%20-%20Part%20III" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=https://julianquandt.com/post/power-analysis-by-data-simulation-in-r-part-iii/&amp;t=Power%20Analysis%20by%20Data%20Simulation%20in%20R%20-%20Part%20III" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Power%20Analysis%20by%20Data%20Simulation%20in%20R%20-%20Part%20III&amp;body=https://julianquandt.com/post/power-analysis-by-data-simulation-in-r-part-iii/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=https://julianquandt.com/post/power-analysis-by-data-simulation-in-r-part-iii/&amp;title=Power%20Analysis%20by%20Data%20Simulation%20in%20R%20-%20Part%20III" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Power%20Analysis%20by%20Data%20Simulation%20in%20R%20-%20Part%20III%20https://julianquandt.com/post/power-analysis-by-data-simulation-in-r-part-iii/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=https://julianquandt.com/post/power-analysis-by-data-simulation-in-r-part-iii/&amp;title=Power%20Analysis%20by%20Data%20Simulation%20in%20R%20-%20Part%20III" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  






  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/admin/avatar_hudb73fd021bfa5c2a11be3c52f827ce28_158023_270x270_fill_q90_lanczos_center.jpg" alt="Avatar">
    

    <div class="media-body">
      <h5 class="card-title"><a href="https://julianquandt.com/">Julian Quandt</a></h5>
      <h6 class="card-subtitle">PhD student</h6>
      <p class="card-text">just a regular person.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:julian_quandt@live.de" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/julianquandt" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.nl/citations?user=lTi0-m4AAAAJ&amp;hl" target="_blank" rel="noopener">
        <i class="ai ai-google-scholar"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/julianquandt" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://www.researchgate.net/profile/Julian_Quandt2" target="_blank" rel="noopener">
        <i class="ai ai-researchgate"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>



<script src="https://utteranc.es/client.js"
        repo="julianquandt/julianquandt.website"
        issue-term="pathname"
        label = "Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>




  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/power-analysis-by-data-simulation-in-r-part-ii/">Power Analysis by Data Simulation in R - Part II</a></li>
      
      <li><a href="/post/power-analysis-by-data-simulation-in-r-part-i/">Power Analysis by Data Simulation in R - Part I</a></li>
      
    </ul>
  </div>
  



  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js" integrity="sha256-1zu+3BnLYV9LdiY85uXMzii3bdrkelyp37e0ZyTAQh0=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.c4716762638572b143da1c828c87dcd8.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
